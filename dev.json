function initializeThumbnails(){var thumbs=$(".video-thumbnails");_.each(thumbs,function(thumbGroup){$(thumbGroup).find("a").length<2&&$(thumbGroup).find("a").hide()}),$(".video-thumbnails").on("click","a",function(e){e.preventDefault(),activateThumbs($(this),$(this).closest(".video-thumbnails").index(".video-thumbnails")),trackGa("cta",$(this).find("img").attr("data-poster-id"))})}function activateThumbs($obj,playerIndex){var container=$(".video-thumbnails").eq(playerIndex);console.log(container),container.find("a").removeClass("active"),$obj.addClass("active");var thumbnail=$obj.find("img"),descriptions=container.find(".desc"),videoId=thumbnail.attr("data-video-id");$(descriptions).removeClass("active"),container.find('.desc[data-desc-id="'+videoId+'"]').addClass("active"),attachVideo(thumbnail,playerIndex)}function attachVideo(thumbnail,playerIndex){var container=$(".video-player").eq(playerIndex);container.find("iframe").length>0&&container.find("iframe").hide(),container.removeClass("player");var videoId=thumbnail.attr("data-video-id"),thumbSource=thumbnail.attr("src"),videoName=thumbnail.data("video-name"),videoClass="";videoClass=thumbSource.indexOf("youtube")>0?"youtube":"youku",container.html("<h6>Watch Video</h6><img class="+videoClass+' data-video-id="'+videoId+'" data-src="'+thumbSource+'" data-video-name="'+videoName+'">'),initialzePoster(playerIndex),container.find("iframe").show()}function initialzePoster(playerIndex){var $videos;$videos=void 0!==playerIndex?$(".video-player").eq(playerIndex):$(".video-player"),$videos.off("click"),$videos.on("click",function(e){var $player=$(this),playerSrc=$player.find("img").attr("data-video-id"),youtubePlayer='<iframe frameborder="0" allowfullscreen src="//www.youtube.com/embed/'+playerSrc+'?html5=1&autoplay=1&rel=0"></iframe>',youkuPlayer='<iframe src="http://player.youku.com/embed/'+playerSrc+'" frameborder="0" allowfullscreen></iframe>',playerTemplate=youtubePlayer;"youku"===$player.find("img").attr("data-video-type")&&(playerTemplate=youkuPlayer),trackGa("video-view",$(this).find("img").attr("data-video-id")),$player.addClass("player").html(playerTemplate).off("click")})}function initializeModal(){modalOpenListener();var hash=window.location.hash;""!==hash&&(data=hash.substring(1),$('a.modal-open[data-subpage="'+data+'"]').trigger("click"))}function modalOpenListener(){$("a.modal-open").on({click:function(e){var windowTop=$(window).scrollTop(),modalId=$(this).data("subpage");attachModal(modalId,windowTop),trackGa("cta",modalId.substr(modalId.lastIndexOf("/")+1)),window.location.hash=$(this).attr("href"),e.preventDefault()}})}function modalCloseListener(windowTop){$("a.modal-close").on({click:function(e){$("html").removeClass("open-modal"),$(this).closest(".modal").remove(),$("html, body").animate({scrollTop:windowTop},"fast"),window.location.hash="",$("html").hasClass("lt-ie9")||history.pushState("",document.title,window.location.pathname),e.preventDefault(),$(this).off("click")}})}function attachModal(modalId,windowTop){$("body").append('<div class="modal"> <div class="container-fluid"><a class="modal-close" href="#">Close</a><iframe src="'+modalId+'.html" width="100%" height="100%" scroll="no"></iframe></div></div>'),$("html").addClass("open-modal"),setTimeout(function(){$(window).scrollTop(0)},50),modalCloseListener(windowTop)}function initializeTrackGa(){$(".subpage .download").on("click",function(){trackGa("download",$(this).attr("data-doc-name"))}),$(".subpage .video-view").on("click",function(){trackGa("video-view",$(this).attr("data-video-name"))}),$(".subpage .cta-tracking").on("click",function(){trackGa("cta",$(this).attr("href"))}),$(".hero-text-container .btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))}),$(".subpage a.btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))}),$(".npi a.btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))}),$(".npi .hero-selector-container .btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-homepage-hero.html")}),$(".event a.pdf").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))}),$(".event a.video").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"Video-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))}),$(".event a.link").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))}),$(".campaign-guidelines a.btn").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))}),$(".event p a").on("click",function(){trackerGA("Landing page",window.location.href.substr(window.location.href.lastIndexOf("/")+1),"CTA-"+$(this).attr("href").substr($(this).attr("href").lastIndexOf("/")+1))})}function trackGa(type,label){var path=window.location.href.substr(window.location.href.lastIndexOf("/")+1);switch(type){case"video-select":type="Video select-"+label;break;case"video-view":type="Video-"+label;break;case"download":type="Download-"+label;break;case"facet":type="facet-"+label;break;default:type="CTA-"+label}trackerGA("Landing page",path,type)}function initializeScene7(){$(".s7-container").each(function(i){var $self=$(this),asset=$self.attr("data-scene-path"),serverUrl="//cat.scene7.com/is/image/",containerID="s7_spinview-"+i;$self.append('<div id="'+containerID+'"></div>'),asset.indexOf(serverUrl)>-1&&(cleanedAsset=asset.split(serverUrl),asset=cleanedAsset[1]);new s7viewers.SpinViewer({containerId:containerID,params:{asset:asset,serverurl:serverUrl,contenturl:"//cat.scene7.com/skins/",config:"Scene7SharedAssets/Universal_HTML5_SpinSet_light"},handlers:{initComplete:function(){$.fn.matchHeight._update()}}}).init()})}function eventNav(){$("#cat-event-nav").affix({offset:{top:400}}),$(".event-nav a").on({click:function(e){e.preventDefault(),$(".event-nav a").removeClass("active"),$(this).toggleClass("active");var id=$(this).attr("href"),$nav=$("#cat-event-nav"),window_offset=$nav.height();$("html, body").animate({scrollTop:$(id).offset().top-window_offset},10)}})}function eventMap(){if($(".map-container").attr("data-location")){var place=$(".map-container").attr("data-location");place=place.replace(/\s/g,"+"),console.log("PLACE",place);var mapOptions={zoom:15,center:new google.maps.LatLng(-34.397,150.644)},map=new google.maps.Map(document.getElementById("event-map-container"),mapOptions);(new google.maps.Geocoder).geocode({address:place},function(results,status){if(status==google.maps.GeocoderStatus.OK){map.setCenter(results[0].geometry.location);var marker=new google.maps.Marker({map:map,position:results[0].geometry.location});map.panTo(marker.getPosition())}else console("Geocode was not successful for the following reason: "+status);google.maps.event.trigger(map,"resize")})}else $(".map-container img").draggable()}function showfloorDraggable(){$(".showfloor-container img").draggable()}function checkForRepeatPattern(){$.each($(".sub-hero .bg-img"),function(){$(this).siblings().length<2&&repeatPattern($(this))})}function repeatPattern($el){setTimeout(function(){$(".info-graphic").matchHeight(!0),$.fn.matchHeight._update()},100)}function updateRowsHeight(){setTimeout(function(){$.fn.matchHeight._update()},100)}function detectUrlAnchor(){var activeAnchor=function(){var headerNav=".campaignEventAnchorNav li a";if(window.location.hash){var hash=window.location.hash,foundNavLink=$(headerNav+"[href$='"+hash+"']");foundNavLink.length>0&&($(headerNav).removeClass("active"),$(foundNavLink).addClass("active"))}else $(headerNav).removeClass("active"),$(headerNav+"[href$='overview']").addClass("active")};$(window).load(function(){activeAnchor()}).bind("hashchange",function(){activeAnchor()})}function initializeContentModuleVideos(){$("figure").fitVids(),$(".fluid-width-video-wrapper iframe").each(function(){$(this).show()})}function accordionTabReset(){$(".panel-group .panel-title a").each(function(){$(this).hasClass("in")||$(this).addClass("collapsed")})}function validateFormField($field){var regex,value=$.trim($field.val()),fieldPasses=!0;switch($field.data("validate")){case"required":$field.is("select")&&(value=$field.find("option:selected").val()),$field.is("fieldset")&&(value=$field.find(":checked").length>0?"checked":"");break;case"email":regex=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,10})+$/,value=regex.test(value)?"email":"";break;case"serial":regexFull=/^[a-z0-9]{3}[0-9]{1,5}$/i,regexPrefix=/^[a-z0-9]{3}$/i,regexFull.test(value)||3==value.length&&regexPrefix.test(value)||(value="");break;case"rental-start-date":var today=new Date;new Date(value).setHours(0,0,0,0)>=today.setHours(0,0,0,0)?$("input.end-date").removeAttr("disabled").siblings(".add-on").show():value="";break;case"rental-end-date":var start=new Date($('[data-validate="rental-start-date"]').val());new Date(value).setHours(0,0,0,0)>=start.setHours(0,0,0,0)||(value="")}var view="";return""===value?($field.addClass("error"),$field.siblings(".error-text").show(),$field.data("view")&&(view=$("#"+$field.data("view")),view.find("input").addClass("error"),view.find(".error-text").show()),fieldPasses=!1):($field.removeClass("error"),$field.siblings(".error-text").hide(),$field.data("view")&&(view=$("#"+$field.data("view")),view.find("input").removeClass("error"),view.find(".error-text").hide())),fieldPasses}function initializeFormValidation(){$("form").each(function(){var formPasses=!0;$(this).find("[data-validate]").length>0&&$(this).on("submit",function(){return formPasses=!0,$(this).find("[data-validate]").each(function(){validateFormField($(this))||(formPasses=!1)}),formPasses})}),$("[data-validate]").each(function(){var $message,tagName;switch($(this).data("validate")){case"required":tagName=this.tagName.toLowerCase(),$message=$('.validate-messages .error-text[data-validate-message="required:'+tagName+'"]').length>0?$('.validate-messages .error-text[data-validate-message="required:'+tagName+'"]'):$('.validate-messages .error-text[data-validate-message="required"]');break;case"email":$message=$('.validate-messages .error-text[data-validate-message="email"]');break;case"serial":$message=$('.validate-messages .error-text[data-validate-message="serial"]');break;case"rental-start-date":$message=$('.validate-messages .error-text[data-validate-message="rental-start-date"]');break;case"rental-end-date":$message=$('.validate-messages .error-text[data-validate-message="rental-end-date"]')}void 0!==$message&&"hidden"!==$(this).attr("type")&&$message.clone().appendTo($(this).parent()).data("validate-message",""),$(this).siblings(".error-text").hide(),$(this).on("blur, change",function(){validateFormField($(this))}),$(this).is("fieldset")&&$(this).find(":checkbox,:radio").on("click",function(){validateFormField($(this).closest("fieldset"))}),$(this).is("select")&&$(this).on("change",function(){validateFormField($(this))})})}function initializeDatePicker(){var today=new Date;$(".date-picker-container").datepicker({autoclose:!0,format:"mm/dd/yyyy",startDate:today,todayHighlight:!0}),$(".date-picker-container").find("input.start-date").length>0&&$("input.end-date").attr("disabled","disabled").siblings(".add-on").hide()}function facetedNavRadioDisplayHandler(){var target=$(".facet-filter input[type=radio]");$(".facet-filter input[type=radio]:checked").next().addClass("on"),$(target).change(function(){$(".facet-filter input[type=radio]:not(:checked)").next().removeClass("on"),$(this).next().addClass("on")})}function exampleLoadingStates(){$(".showloading").on("click",function(e){e.preventDefault(),miniformLoadingScreen($(".mini-form:not(.callout)"))}),$(".showloaded").on("click",function(e){e.preventDefault();$(".mini-form:not(.callout)").html('<p>Thanks! Your product information is ready for download.</p><ul class="secondary-links"><li><a href="#">Download 320 L Brochure</a></li><li><a href="#">Download 320 L Specs</a></li></ul><strong>Related Product Information</strong><ul class="secondary-links"><li><a href="#">Download 320 L Brochure</a></li><li><a href="#">Download 320 L Specs</a></li></ul>')}),$(".showoriginal").on("click",function(e){e.preventDefault(),location.reload()})}function miniformLoadingScreen(form){$(form).append("<div class='loading'><div class='spinner-container'><span class='spinner'></span>Loading...</div></div>")}function initializeMQProxy(){$(window).on("throttledresize",function(event){var previouslyMobile=$("body").data("is-mobile"),currentlyMobile=Math.round($("footer .span3").width())===Math.round($("footer .span7").width());$("body").data("is-mobile",currentlyMobile),previouslyMobile!=currentlyMobile&&$("body").trigger({type:"mode-change",mobile:currentlyMobile,time:new Date})}),$.event.trigger("throttledresize")}function initializeNavEventHandlers(){$("nav >ul >li.menu >a, nav >ul >li.menu >ul >li >a").on("click",function(e){$("body").data("is-mobile")&&(e.preventDefault(),$(this).parent().siblings().removeClass("active"),$(this).parent().toggleClass("active"),forceWebkitRedraw())}).on("mouseover",function(e){$("nav li.location, nav li.search").removeClass("active")}),$("nav >ul >li.search >a").on("click",function(e){$("body").data("is-mobile")&&(e.preventDefault(),$(this).parent().siblings().removeClass("active"),$(this).parent().toggleClass("active"),$("body").data("is-mobile")&&forceWebkitRedraw())}),$("nav li.products >div >ul >li").on("mouseover",function(e){$("body").data("is-mobile")||$("nav li.products >div").addClass("extended")}).on("mouseout",function(e){$("body").data("is-mobile")||$("nav li.products >div").removeClass("extended")}),$("nav li.menu, nav >ul >li.search").on("mouseover",function(e){$("body").data("is-mobile")||($("nav li.location > div > ul > li").removeClass("active"),$("nav li.location > div > ul > li > a").attr("aria-expanded","false"),$("nav li.location > div > ul > li > div").attr("aria-hidden","true"))}),$("nav li.location").on("mouseover",function(e){e.preventDefault(),$(this).parent().siblings().removeClass("active"),$("nav li.location").toggleClass("active"),$(this).attr("aria-expanded","false"),$(this).parent().find(">div").attr("aria-hidden","true")}).on("mouseout",function(e){e.preventDefault(),$("nav li.location").toggleClass("active"),$(this).attr("aria-expanded","true"),$(this).parent().find(">div").attr("aria-hidden","false")}),$("nav li.location >div >ul >li >a").on("mouseover",function(e){$(this).parent().addClass("active"),$(this).attr("aria-expanded","true"),$(this).parent().find(">div").attr("aria-hidden","false"),$(this).parent().addClass("active").siblings().removeClass("active")})}function forceWebkitRedraw(){$("body").hide();$("body").get(0).offsetHeight;$("body").show()}function countriesLayout(){$(".menu-countries").length>0&&$(".menu-countries").columnize({width:350,lastNeverTallest:!0,doneFunc:function(){$(".menu-countries").css("visibility","visible")}})}function initalizePlaceholder(){$("input, textarea").placeholder()}function initializeCarousel(){navigator.userAgent.toLowerCase();(!1==("undefined"!=typeof swfobject&&0!==swfobject.getFlashPlayerVersion().major)&&$(".carousel-flash-360s").remove(),$(".product-gallery .gallery-filters").show(),$(".product-gallery .carousel li").length>0)?(toggleGallery($(".product-gallery .carousel ul:first-child li:first-child a img")),$(".product-gallery .carousel li").length>1?(filterGallery($(".gallery-filters a:first-child").data("filter")),$(".gallery-filters").on("click","a",function(e){e.preventDefault(),filterGallery($(this).data("filter"))}),$("#gallery-viewer").attr("aria-owns",""),$(".product-gallery .carousel ul li a").each(function(index){$(this).attr("id","carousel-item-"+index);var gallaryViewerOwns=$("#gallery-viewer").attr("aria-owns")+" "+$(this).attr("id");$("#gallery-viewer").attr("aria-owns",gallaryViewerOwns),$(this).attr("aria-controls","gallery-viewer")}),$(".gallery-filters ul li a").each(function(index){$(this).attr("aria-controls","carousel-"+$(this).data("filter"))}),$(".product-gallery .mobile-controls").on("click","a",function(e){e.preventDefault();var activeElement=$(".product-gallery .carousel  li a.active").parent();activeElement=$(".product-gallery .carousel li").index(activeElement),$(this).hasClass("next")?(nextElement=$(".product-gallery .carousel li").eq(activeElement+1).find("a img"),nextElement.length<1&&(nextElement=$(".product-gallery .carousel li").eq(0).find("a img"))):(nextElement=$(".product-gallery .carousel li").eq(activeElement-1).find("a img"),nextElement.length<1&&(nextElement=$(".product-gallery .carousel li").last().find("a img"))),toggleGallery(nextElement)}),$(".product-gallery .carousel ul").on("click","a",function(e){$(".product-gallery .carousel a").attr("aria-selected","false"),$(this).attr("aria-selected","true"),e.preventDefault(),toggleGallery($(this).find("img"))}),setInternalCarouselWidth(Math.round($("footer .span3").width())===Math.round($("footer .span7").width())),$(".product-gallery .paginator").on("click","a",function(e){e.preventDefault(),setCarouselPage($(this).attr("class"))}),$(document).on("mode-change","body",function(mode){setInternalCarouselWidth(mode.mobile)}),$(window).on("throttledresize",function(event){setCarouselWidth(),setGalleryHeight()}),setGalleryHeight(),$(".product-gallery .gallery-filters, .product-gallery .paginator").show()):($(".product-gallery #gallery-viewer img, .product-gallery #gallery-viewer .fluid-width-video-wrapper").css("position","static"),$(".product-gallery .gallery-filters, .product-gallery .paginator").hide(),$(".product-gallery .mobile-controls, .product-gallery .carousel").remove())):$(".product-gallery").remove()}function setGalleryHeight(){var galleryWidth=$("#gallery-viewer").outerWidth();$("#gallery-viewer").css("height",3*galleryWidth/4+"px")}function setInternalCarouselWidth(mobile){if(!mobile&&!0!==$(".product-gallery .carousel").data("width-set")){$(".product-gallery .carousel").data("width-set",!0);var itemWidth=$(".product-gallery .carousel ul li").outerWidth();$(".product-gallery .carousel ul").each(function(){var itemMargin=parseInt($(this).find("li").css("margin-right"),10),carouselWidth=$(this).find("li").length;carouselWidth*=itemWidth+itemMargin,$(this).css("width",carouselWidth+"px")})}}function setCarouselWidth(){var itemWidth=$(".product-gallery .carousel ul.active li").outerWidth(!0),itemMargin=parseInt($(".product-gallery .carousel ul.active li").css("margin-right"),10),carouselContainerWidth=$(".product-gallery").outerWidth(),imagesDisplayedPerPage=Math.floor((carouselContainerWidth+itemMargin)/itemWidth);if($("body").data("is-mobile"))for($(".product-gallery .carousel li").removeClass("last"),i=imagesDisplayedPerPage;i<=$(".product-gallery .carousel li").length;i+=imagesDisplayedPerPage){var lastImage=i-1;$(".product-gallery .carousel li").eq(lastImage).addClass("last")}else{carouselContainerWidth=imagesDisplayedPerPage*itemWidth-itemMargin+1,$(".product-gallery .carousel").css("max-width",carouselContainerWidth+"px"),$(".product-gallery .paginator").css("max-width",carouselContainerWidth+"px");var pages=Math.ceil($(".product-gallery .carousel ul.active li").length/imagesDisplayedPerPage),activeElement=$(".product-gallery .carousel ul.active a.active").parent().index();activeElement<0&&(activeElement=0);var currentPage=Math.ceil((activeElement+1)/imagesDisplayedPerPage);$(".product-gallery .paginator").data("total-pages",pages),$(".product-gallery .paginator").data("current-page",currentPage),$(".product-gallery .paginator").data("images-displayed-per-page",imagesDisplayedPerPage),setCarouselPage()}}function setCarouselPage(direction){if(currentPage=$(".product-gallery .paginator").data("current-page"),pages=$(".product-gallery .paginator").data("total-pages"),imagesDisplayedPerPage=$(".product-gallery .paginator").data("images-displayed-per-page"),direction&&(direction.indexOf("previous")>=0?currentPage-=1:direction.indexOf("next")>=0&&(currentPage+=1),currentPage<1||currentPage>pages))return!1;$(".product-gallery .paginator").data("current-page",currentPage);var leftPosition,itemWidth=$(".product-gallery .carousel ul.active li").outerWidth(!0);parseInt($(".product-gallery .carousel ul li").css("margin-right"),10);currentPage<=1?(leftPosition="0",currentPage=1):leftPosition=(currentPage-1)*(imagesDisplayedPerPage*itemWidth)*-1,Granite.I18n.setLocale($("meta[property='og:locale']").attr("content")),$(".product-gallery .paginator .paginator-number").html(currentPage+" "+Granite.I18n.get("of")+" "+pages),1===pages?$(".product-gallery .paginator").addClass("hidden"):$(".product-gallery .paginator").removeClass("hidden"),$(".product-gallery .carousel ul.active").css("left",leftPosition+"px")}function filterGallery(filter){$(".gallery-filters li").removeClass("active"),$('.gallery-filters li a[data-filter="'+filter+'"]').parent().addClass("active"),$(".product-gallery .carousel ul").removeClass("active"),$(".product-gallery .carousel .carousel-"+filter).addClass("active"),toggleGallery($(".product-gallery .carousel ul.active li:first-child a img")),$(".gallery-filters li:not(.active) a").attr("aria-expanded","false"),$(".gallery-filters li.active a").attr("aria-expanded","true"),$(".product-gallery .carousel ul:not(.active)").attr("aria-hidden","true"),$(".product-gallery .carousel ul.active").attr("aria-hidden","false"),setCarouselWidth()}function toggleGallery(thumbnail){$(".product-gallery iframe").length>0&&$(".product-gallery iframe").hide(),$(".product-gallery .carousel li a").removeClass("active");var activeElement=$(thumbnail).closest("li"),currentElement=$(".product-gallery .carousel li").index(activeElement)+1;Granite.I18n.setLocale($("meta[property='og:locale']").attr("content")),$(".product-gallery .mobile-paginator-number").html(currentElement+" "+Granite.I18n.get("of")+" "+$(".product-gallery .carousel li").length),$(thumbnail).parent().addClass("active");var type=thumbnail.data("carousel-type");switch(type){case"image":var fullSizeImage="<img src='"+thumbnail.data("fullsize-src")+"' alt='' />";$("#gallery-viewer").html(fullSizeImage),$("#gallery-text").html(thumbnail.attr("alt"));break;case 360:var xmlfile=thumbnail.data("xmlfile"),loaderURI=(thumbnail.data("vpt-type"),thumbnail.data("vpt-loader-uri"));$("#gallery-viewer").html("<div id='gallery-360s' class='fluid-width-video-wrapper' style='padding-top: 66.419355%;'><iframe src="+loaderURI+xmlfile+" frameborder='0' height='380' width='100%' id='vpt' style='height: 384px;'></iframe></div>"),$("#gallery-text").html(thumbnail.attr("alt"));break;case"scene7":$("#gallery-viewer").html("<div id='s7_spinview'></div>"),$("#gallery-text").html(thumbnail.attr("alt")),scene7(activeElement.find("img").attr("data-scene-id"));break;case"video":var protocol=thumbnail.data("protocol"),type=thumbnail.data("videotype");if("youku"==type){var videoID=thumbnail.data("youku-id"),height=thumbnail.data("youku-height"),width=thumbnail.data("youku-width");$(".ie").length>0?$("#gallery-viewer").html('<embed src="http://player.youku.com/player.php/sid/'+videoID+'/v.swf" allowFullScreen="true" quality="high" width="'+width+'" height="'+height+'" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></embed>'):$("#gallery-viewer").html('<iframe width="'+width+'" height="'+height+'" src="'+protocol+"://player.youku.com/embed/"+videoID+'?wmode=transparent" frameborder="0" allowfullscreen></iframe>')}else{var videoID=thumbnail.data("video-id"),videoLink=thumbnail.data("video-link"),height=thumbnail.data("video-height"),width=thumbnail.data("video-width");void 0===videoLink?(""!=thumbnail.data("youtube-id")&&(videoID=thumbnail.data("youtube-id")),height=thumbnail.data("youtube-height"),width=thumbnail.data("youtube-width"),protocol="https:"==document.location.protocol?"https":"http",$("#gallery-viewer").html('<iframe width="'+width+'" height="'+height+'" src="//www.youtube.com/embed/'+videoID+'?wmode=transparent" frameborder="0" allowfullscreen></iframe>')):$("#gallery-viewer").html('<iframe width="'+width+'" height="'+height+'" src="'+videoLink+'&wmode=transparent" frameborder="0" allowfullscreen></iframe>')}embedCompleteFunction(),$("#gallery-text").html(thumbnail.attr("alt"))}}function scene7(asset){new s7viewers.SpinViewer({containerId:"s7_spinview",params:{asset:asset,serverurl:"//cat.scene7.com/is/image/",contenturl:"//cat.scene7.com/skins/",config:"Scene7SharedAssets/Universal_HTML5_SpinSet_light"}}).init()}function load360(xmlfile,vptType){var flashvars={showPopups:"true",usePopupImageWindows:"true",vptType:vptType,xmlfile:xmlfile},params={scale:"showall",salign:"TL",align:"TL",wmode:"transparent"},attributes={id:"vpt"};swfobject.embedSWF("gallery-360s/vpt_loader.swf","gallery-360s","620","356","10.0.0","gallery-360s/expressInstall.swf",flashvars,params,attributes,embedCompleteFunction)}function embedCompleteFunction(){$(".gallery-viewer").fitVids()}function initializeFlexTableEventHandlers(){$(".flextable").on("mouseover","tr",function(e){$(this).hasClass("flextable-detail-show")?$(this).next().hasClass("flextable-row-detail")&&$(this).next().addClass("active"):$(this).prev().hasClass("flextable-detail-show")&&($(this).prev().addClass("active"),$(this).addClass("active"))}).on("mouseout","tr",function(e){$(this).hasClass("flextable-detail-show")?$(this).next().hasClass("flextable-row-detail")&&$(this).next().removeClass("active"):$(this).prev().hasClass("flextable-detail-show")&&($(this).prev().removeClass("active"),$(this).removeClass("active"))}).on("click","tr.flextable-detail-show td.flextable-control a",function(e){$(this).closest("tr.flextable-detail-show").next().hasClass("flextable-row-detail")&&($("tr.flextable-detail-show, tr.flextable-row-detail").removeClass("active"),$(this).closest("tr.flextable-detail-show").addClass("active").next().addClass("active"))}).on("click","tr.flextable-row-detail .custom-flextable-control a",function(e){$(this).closest(".flextable-row-detail").prev().hasClass("flextable-detail-show")&&($("tr.flextable-detail-show, tr.flextable-row-detail").removeClass("active"),$(this).closest(".flextable-row-detail").addClass("active").prev().addClass("active"))})}function initializeTabs(){$(".tab-wrapper").tabify({hideClass:"tab-hidden"}),$(".tab-wrapper").each(function(){setAccessibilityTags($(this)),addToggleControls($(this)),$(this).attr("role","tablist"),$(this).find("> h2").attr("role","tab")}),$(".tab-wrapper").on("click","h2.tab",function(e){if($wrapper=$(this).closest(".tab-wrapper"),e.preventDefault(),$("html").hasClass("lt-768")){var handler=$(this).data("toggle-tab-handler"),$target=$('[data-toggle-tab-group="'+handler+'"]');$(this).hasClass("open")?$wrapper.data("last-selected",""):$wrapper.data("last-selected",handler),toggle($(this),$target)}else $(this).trigger("tabClick"),setAccessibilityTags($wrapper)}),$("h2.tab a").on("keydown",function(e){if(37===e.which||39===e.which){var $newTab,$parentTab=$(this).parent();$newTab=37===e.which?0===$parentTab.index()?$parentTab.siblings("h2.tab").last().find("a"):$parentTab.prev().prev().find("a"):0===$parentTab.next().next("h2.tab").size()?$parentTab.siblings("h2.tab").first().find("a"):$parentTab.next().next().find("a"),$newTab.focus()}}),$("html").hasClass("ie")?setTabMode($("body").data("is-mobile")):$(window).load(function(){setTabMode($("body").data("is-mobile"))}),$(document).on("mode-change","body",function(mode){setTabMode(mode.mobile)})}function setTabMode(mobile){checkLastSelected(mobile),mobile||fixTabWidth()}function setAccessibilityTags($wrapper){$currentTab=$wrapper.find(".tab.selected"),$currentTabContent=$wrapper.find(".tab-content:not(.tab-hidden)"),$currentTabContent.attr("aria-hidden","false"),$currentTab.attr("aria-expanded","true"),$currentTabContent.attr("tabindex","0"),$wrapper.find(".tab-content.tab-hidden").attr("aria-hidden","true"),$wrapper.find(".tab:not(.selected)").attr("aria-expanded","false")}function fixTabWidth(padding){$(".tab-wrapper").each(function(){var newMargin=$(this).find(".tab").eq(0).height();$(this).css({"padding-top":newMargin+"px"}),$wrapper=$(this);var spacing=padding||0;$wrapper.find(".tab").each(function(){$(this).css("left",spacing+"px"),spacing+=$(this).outerWidth()})})}function checkLastSelected(mobile){$(".tab-wrapper").each(function(){if(mobile){$selectedTab=$(this).find(".tab.selected"),0===$selectedTab.length&&($selectedTab=$(this).find(".tab:first-child")),$selectedTab.addClass("open").removeClass("selected");var handler=$selectedTab.data("toggle-tab-handler");$target=$('[data-toggle-tab-group="'+handler+'"]'),$target.addClass("show"),$(this).data("last-selected",$selectedTab.data("toggle-tab-handler"))}else $selectedTab=$(".tab[data-toggle-tab-handler='"+$(this).data("last-selected")+"']"),$(this).find(".tab").removeClass("open"),$(this).find(".tab-content").removeClass("show"),$selectedTab.length>0?$selectedTab.trigger("tabClick"):($(this).find("h2.selected").length>0?$selectedTab=$(this).find(".selected"):$selectedTab=$(this).find(".tab").first(),$selectedTab.trigger("tabClick"))})}function addToggleControls($wrapper){$wrapper.find(".tab").each(function(){var handler=$(this).attr("aria-controls"),$target=$("#"+handler);$(this).data("toggle-tab-handler",handler),$(this).attr("data-toggle-tab-handler",handler),$target.attr("data-toggle-tab-group",handler)})}function initializeToggles(){$("body").on("click","[data-toggle-mobile-handler]",function(e){if(e.preventDefault(),$("html").hasClass("lt-768")){var handler=$(this).data("toggle-mobile-handler"),$target=$('[data-toggle-mobile-group="'+handler+'"]');toggle($(this),$target)}}),$("body").on("keypress","[data-toggle-mobile-handler]",function(e){13==e.which&&$(this).trigger("click")}),$("body").on("click","[data-toggle-handler]",function(e){e.preventDefault();var handler=$(this).data("toggle-handler"),$target=$('[data-toggle-group="'+handler+'"]');toggle($(this),$target)}),$("[data-toggle-handler]").each(function(){var handler=$(this).data("toggle-handler"),$target=$('[data-toggle-group="'+handler+'"]');$(this).hasClass("open")&&$target.addClass("show"),setToggleAriaTags($(this),handler,$target)}),setToggleMode($("body").data("is-mobile")),$(document).on("mode-change",function(mode){setToggleMode(mode.mobile)})}function toggle($handler,$target){var noToggle=!1;"toggle-sidekick"!=$handler.data("toggle-handler")||$("html").hasClass("touch")||(noToggle=!0),!1===noToggle&&($handler.toggleClass("open"),$target.toggleClass("show"),$handler.attr("aria-expanded",$target.hasClass("show")),$target.attr("aria-hidden",!$target.hasClass("show")))}function setToggleMode(mobile){mobile?$("[data-toggle-mobile-handler]").each(function(index){var handler=$(this).data("toggle-mobile-handler"),$target=$('[data-toggle-mobile-group="'+handler+'"]'),toggleHTML=$(this).html();$(this).html('<a href="#">'+toggleHTML+"</a>"),setToggleAriaTags($(this),handler,$target)}):$("[data-toggle-mobile-handler]").each(function(index){var handler=$(this).data("toggle-mobile-handler"),$target=$('[data-toggle-mobile-group="'+handler+'"]');if($(this).find("a").length>0){var toggleHTML=$(this).find("a").html();$(this).html(toggleHTML)}$(this).attr("tabindex","-1"),
$(this).removeAttr("aria-expanded"),$target.removeAttr("aria-hidden"),$(this).removeAttr("aria-controls"),$(this).removeAttr("role")})}function setToggleAriaTags($toggle,handler,$target){controlName=handler.replace("toggle-",""),$toggle.attr("aria-controls",controlName),$target.attr("id",controlName),$toggle.attr("tabindex","0"),$toggle.attr("role","button"),$toggle.attr("aria-expanded",$toggle.hasClass("open")),$target.attr("aria-hidden",!$toggle.hasClass("open"))}function initializeToolTips(){if(!("ontouchstart"in document.documentElement)){var tooltipOptions={container:".carousel",placement:"bottom"};$(".product-gallery .carousel ul li").tooltip(tooltipOptions)}}function triggerUnitSwitch(unit){$(".unit").addClass("unit-hidden").filter(".unit-"+unit).removeClass("unit-hidden"),$("li[data-switch-class]").removeClass("active").filter('[data-switch-class="'+unit+'"]').addClass("active")}function initializeUnitSwitch(defaultUnit){$("li[data-switch-class]").on("click",function(e){e.preventDefault(),triggerUnitSwitch($(this).data("switch-class")),setCookie("selectedUnits",$(this).data("switch-class"),7300),window._cat_locale_metric=window._cat_default_locale==$(this).data("switch-class")}),defaultUnit&&triggerUnitSwitch(defaultUnit)}head.ready(function(){setTimeout(function(){var selectedUnits=getCookie("selectedUnits");selectedUnits?(initializeUnitSwitch(selectedUnits),window._cat_locale_metric=window._cat_default_locale===selectedUnits):initializeUnitSwitch(window._cat_default_locale)},10)}),head.ready(function(){initialzePoster(),$(".subpage").length>0&&$(".subpage").find(".flextable").flextable(),$(".campaign-guidelines .video-thumbnails").length>0&&initializeThumbnails(),detectUrlAnchor(),initializeModal(),initializeTrackGa(),$(".s7-container").length>0&&initializeScene7(),$(".subpage .content-module-secondary .span6.info-graphic h6").closest(".info-graphic").hide(),repeatPattern($(".repeat-pattern .bg-img")),eventNav(),$(".showfloor-container").length>0&&showfloorDraggable(),$(".info-graphic").find(".tile-image").length>0&&$(".info-graphic").find(".tile-image").parent().parent().addClass("tile-image-holder"),$(".event").length&&$(".event").find(".flextable").flextable(),setTimeout(function(){$(".map-container").length>0&&eventMap()},4e3)}),head.ready(function(){$("figure iframe").length>0&&initializeContentModuleVideos()}),head.ready(function(){$(".panel-group").length>0&&accordionTabReset()}),window.validateForm=validateFormField,head.ready(function(){initializeDatePicker(),initializeFormValidation(),facetedNavRadioDisplayHandler()});var CatNS=CatNS||{};CatNS.i18n={keys:{},loadKeys:function(callback){var self=this;amplify.request.define("CAT_I18N","ajax",{url:window._cat_effective_url+"/_jcr_content.i18n.json",dataType:"json",type:"GET"}),amplify.request({resourceId:"CAT_I18N",success:function(data){self.keys=data,callback()},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})},get:function(name){return this.keys[name]?this.keys[name]:"Missing i18n"}},$(function(){}),head.ready(function(){exampleLoadingStates()}),head.ready(function(){initializeMQProxy()}),head.ready(function(){$(".tableContainer table").each(function(){$table=$(this);var moreText=$table.closest(".tableContainer").find(".moreText:first").html(),lessText=$table.closest(".tableContainer").find(".lessText:first").html();$table.attr("border",0),$table.find("tr:first").children().each(function(){var cssClass=$(this).attr("class");cssClass&&($(this).removeAttr("class"),cssClass.indexOf("always")>=0?$(this).attr("data-hide","phone-portrait,phone-landscape,tablet-portrait,tablet-landscape,desktop-full,always"):$(this).attr("data-hide",cssClass))}),$firstRowHtml=$table.find("tr:first"),$firstRowHtml.html($firstRowHtml.html().replace(/<td/g,"<th").replace(/<\/td/g,"</th")),$firstRowHtml=$firstRowHtml.append("<th class='flextable-control flextable-last-column'> </th>"),$tableHead=$("<thead></thead>").append($firstRowHtml),$table.prepend($tableHead),$table.find("tbody > tr").each(function(){$tableRow=$(this),$tableRow.append("<td class='flextable-control flextable-last-column'><a href='#table-toggle'><span class='collapsed'>"+moreText+"</span><span class='expanded'>"+lessText+"</span></a></td>")}),$table.attr("class","flextable")}),$(".flextable").length>0&&$(".tableContainer").length>0&&($(".flextable").flextable(),initializeFlexTableEventHandlers(),$(".tableContainer").css("visibility","visible"))}),head.ready(function(){initializeNavEventHandlers(),countriesLayout()}),head.ready(function(){initalizePlaceholder()}),head.ready(function(){$(".product-gallery .carousel").length>0&&initializeCarousel()});var CatNS=CatNS||{};CatNS.social={},CatNS.social.patterns=[{name:"en",path:"/en_IN/"},{name:"ru",path:"/ru_RU/"},{name:"zh",path:"/zh_CN/"},{name:"pt",path:"/pt_BR/"}],CatNS.social.shareLinks=[{twitter:[{url:"https://twitter.com/intent/tweet?url=",width:"610",height:"470"},{network:"en,pt,ru"},{title:"&text="}],facebook:[{url:"https://facebook.com/sharer.php?u=",width:"545",height:"300"},{network:"en,pt,ru"},{title:"&t="}],linkedIn:[{url:"http://linkedin.com/shareArticle?mini=true&url=",width:"480",height:"620"},{network:"en,pt,ru"}],google:[{url:"https://plus.google.com/share?url=",width:"568",height:"458"},{network:"en,pt,ru"}],vk:[{url:"http://vk.com/share.php?url=",width:"655",height:"453"},{network:"ru"},{title:"&title="}],odnoklassniki:[{url:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl=",width:"600",height:"321"},{network:"ru"},{title:"&title="}],"sina-weibo":[{url:"http://service.weibo.com/share/share.php?url=",width:"650",height:"492"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pic="}],"netease-weibo":[{url:"http://t.163.com/article/user/checkLogin.do?link=http://news.163.com/&source=&info="+encodeURIComponent($("meta[property='og:title']").attr("content")),width:"750",height:"281"},{network:"zh"},{title:"&source=&info="}],"tencent-weibo":[{url:"http://share.v.t.qq.com/index.php?c=share&a=index&url=",width:"658",height:"488"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pic="}],"tencent-qzone":[{url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=",width:"600",height:"626"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pics="}],"baidu-space":[{url:"http://apps.hi.baidu.com/share/?url=",width:"600",height:"608"},{network:"zh"},{title:"&title="},{summary:"&summary="},{pic:"&pic="}]}],function($){$(function(){CatNS.social.shareListener=function(){var href,social,title,articleTitle,articleSummary,articlePic,isMobile,windowObjectReference,width,height,left,top,strWindowFeatures,url=document.URL;if($(".social-toolbox").length<1||$(".social-toolbox .share").length<1)return!1;isMobile=!(!$("html").hasClass("touch")&&!$("html").hasClass("lt-800")),$(".social-toolbox .share").on("click",function(event){event.preventDefault(),articleTitle=encodeURIComponent($("meta[property='og:title']").attr("content")),articleSummary=encodeURIComponent($("meta[property='og:description']").attr("content")),articlePic=encodeURIComponent($("meta[property='og:image']").attr("content")),social=$.trim($(event.currentTarget).attr("class").replace("share","")),href=CatNS.social.shareLinks[0][social][0].url+url,CatNS.social.shareLinks[0][social][2]&&CatNS.social.shareLinks[0][social][2].title&&(title=CatNS.social.shareLinks[0][social][2].title,title+=articleTitle,href+=title),CatNS.social.shareLinks[0][social][3]&&CatNS.social.shareLinks[0][social][3].summary&&(title=CatNS.social.shareLinks[0][social][3].summary,title+=articleSummary,href+=title),CatNS.social.shareLinks[0][social][4]&&CatNS.social.shareLinks[0][social][4].pic&&(title=CatNS.social.shareLinks[0][social][4].pic,title+=articlePic,href+=title),trackerGA("social share","share on "+social,url),!1===isMobile?(width=600,height=260,CatNS.social.shareLinks[0][social][0].width&&CatNS.social.shareLinks[0][social][0].height&&(width=CatNS.social.shareLinks[0][social][0].width,height=CatNS.social.shareLinks[0][social][0].height),left=screen.width/2-width/2,top=screen.height/2-height/2,strWindowFeatures="menubar=no, location=no, resizable=yes, scrollbars=yes, status=no, width="+width+", height="+height+", top="+top+", left="+left,windowObjectReference=window.open(href,"",strWindowFeatures)):windowObjectReference=window.open(href,"_blank")})},CatNS.social.shareLocalization=function(){var network,url=document.URL,pattern=CatNS.social.patterns[0].name,htmlLinks="";if($(".social-toolbox").length<1)return!1;$.each(CatNS.social.patterns,function(i,item){if(url.indexOf(CatNS.social.patterns[i].path)>-1)return pattern=CatNS.social.patterns[i].name}),$.each(CatNS.social.shareLinks[0],function(i,item){network=CatNS.social.shareLinks[0][i][1].network,pathExist=network.indexOf(pattern),pathExist>-1&&(htmlLinks=htmlLinks+'<li><a class="'+i+' share" href="#"></a></li>')}),$(".social-toolbox").html(htmlLinks)},CatNS.social.init=function(){CatNS.social.shareLocalization(),CatNS.social.shareListener()},CatNS.social.init()})}(jQuery,window),function($,w,undefined){function Timer(){var t=this;t.id=null,t.busy=!1,t.start=function(code,milliseconds){t.busy||(t.stop(),t.id=setTimeout(function(){code(),t.id=null,t.busy=!1},milliseconds),t.busy=!0)},t.stop=function(){null!==t.id&&(clearTimeout(t.id),t.id=null,t.busy=!1)}}function Flextable(t,o,id){var ft=this;ft.id=id,ft.table=t,ft.options=o,ft.breakpoints=[],ft.breakpointNames="",ft.columns={};var opt=ft.options,cls=opt.classes,indexOffset=0;return ft.timers={resize:new Timer,register:function(name){return ft.timers[name]=new Timer,ft.timers[name]}},w.flextable.plugins.init(ft),ft.init=function(){var $window=$(w),$table=$(ft.table);if($table.hasClass(cls.loaded))return void ft.raise("flextable_already_initialized");$table.addClass(cls.loading),$table.find("> thead > tr:last-child > th").each(function(){var data=ft.getColumnData(this);if(ft.columns[data.index]=data,null!==data.className){var selector="",first=!0;$.each(data.matches,function(m,match){first||(selector+=", "),selector+="> tbody > tr:not(.flextable-row-detail) > td:nth-child("+(parseInt(match,10)+1)+")",first=!1}),$table.find(selector).not(".flextable-cell-detail").addClass(data.className)}});for(var name in opt.breakpoints)ft.breakpoints.push({name:name,width:opt.breakpoints[name]}),ft.breakpointNames+=name+" ";ft.breakpoints.sort(function(a,b){return a.width-b.width}),ft.bindToggleSelectors(),ft.raise("flextable_initializing"),$table.bind("flextable_initialized",function(){ft.resize(),$table.removeClass(cls.loading),$table.find('[data-init="hide"]').hide(),$table.find('[data-init="show"]').show(),$table.addClass(cls.loaded)}),$window.bind("resize.flextable",function(){ft.timers.resize.stop(),ft.timers.resize.start(function(){ft.resize()},opt.delay)}),ft.raise("flextable_initialized")},ft.bindToggleSelectors=function(){var anchors,$table=$(ft.table);anchors=opt.selectorEnabled?$table.find(opt.toggleSelector):opt.toggleSelector.find(".flextable-control a"),anchors.unbind("click.flextable").bind("click.flextable",function(e){if(e.preventDefault(),$table.is(".breakpoint")){var $row=$(this).closest("tr");ft.toggleDetail($row.get(0))}}),$table.find(opt.customToggleSelector).bind("click.flextable",function(e){e.preventDefault();var $row=$(this).closest("tr"),$customTable=$(this).parent().next();ft.toggleCustomDetail($row.get(0),$customTable,$(this).parent(),$(this))})},ft.parse=function(cell,column){return(opt.parsers[column.type]||opt.parsers.alpha)(cell)},ft.getColumnData=function(th){var $th=$(th),hide=$th.data("hide"),index=$th.index();$th.data("custom");hide=hide||"",hide=hide.split(",");var data={index:index,hide:{},type:$th.data("type")||"alpha",name:$th.data("name")||$.trim($th.text()),ignore:$th.data("ignore")||!1,className:$th.data("class")||null,matches:[],names:{},group:$th.data("group")||null,groupName:null};if(null!==data.group){var $group=$(ft.table).find('> thead > tr.flextable-group-row > th[data-group="'+data.group+'"], > thead > tr.flextable-group-row > td[data-group="'+data.group+'"]').first();data.groupName=ft.parse($group,{type:"alpha"})}var pcolspan=parseInt($th.prev().attr("colspan")||0,10);indexOffset+=pcolspan>1?pcolspan-1:0;var colspan=parseInt($th.attr("colspan")||0,10),curindex=data.index+indexOffset;if(colspan>0){var names=$th.data("names");names=names||"",names=names.split(",");for(var i=0;i<colspan;i++)data.matches.push(i+curindex),i<names.length&&(data.names[i+curindex]=names[i])}else data.matches.push(curindex);data.hide.default="all"===$th.data("hide")||$.inArray("default",hide)>=0;for(var name in opt.breakpoints)data.hide[name]="all"===$th.data("hide")||$.inArray(name,hide)>=0;return ft.raise("flextable_column_data",{column:{data:data,th:th}}).column.data},ft.getViewportWidth=function(){return window.innerWidth||(document.body?document.body.offsetWidth:0)},ft.getViewportHeight=function(){return window.innerHeight||(document.body?document.body.offsetHeight:0)},ft.hasBreakpointColumn=function(breakpoint){for(var c in ft.columns)if(ft.columns[c].hide[breakpoint])return!0;return!1},ft.resetCustomDetails=function(breakpointName){var $table=$(ft.table);$table.find(".custom-flextable-control").removeClass("open").addClass("close"),$table.find(".flextable-row-detail").each(function(){var isCustom=$(this).hasClass("custom-detail");$(this).hasClass("open");if(isCustom){var actualRow=$(this).prev(),control=actualRow.find(".custom-flextable-control"),innerTable=control.next(),btn=control.find("a");btn.unbind("click.flextable").bind("click.flextable",function(e){ft.toggleCustomDetail(actualRow,innerTable,control,btn)}),setTimeout(function(){actualRow.next().remove()},0)}})},ft.resize=function(){var $table=$(ft.table),info={width:$table.width(),height:$table.height(),viewportWidth:ft.getViewportWidth(),viewportHeight:ft.getViewportHeight(),orientation:null};info.orientation=info.viewportWidth>info.viewportHeight?"landscape":"portrait",info.width=info.viewportWidth,info.height=info.viewportHeight;var pinfo=$table.data("flextable_info");if($table.data("flextable_info",info),ft.raise("flextable_resizing",{old:pinfo,info:info}),!pinfo||pinfo&&pinfo.width&&pinfo.width!=info.width||pinfo&&pinfo.height&&pinfo.height!=info.height){for(var breakpoint,current=null,i=0;i<ft.breakpoints.length;i++)if((breakpoint=ft.breakpoints[i])&&breakpoint.width&&info.width<=breakpoint.width){current=breakpoint;break}var breakpointName=null===current?"default":current.name,hasBreakpointFired=ft.hasBreakpointColumn(breakpointName);hasBreakpointFired&&ft.resetCustomDetails(breakpointName),$table.removeClass("default breakpoint no-breakpoint").removeClass(ft.breakpointNames).addClass(breakpointName+(hasBreakpointFired?" breakpoint":" no-breakpoint")).find("> thead > tr:last-child > th").each(function(){var data=ft.columns[$(this).index()],selector="",first=!0;$.each(data.matches,function(m,match){first||(selector+=", ");var count=match+1;selector+="> tbody > tr:not(.flextable-row-detail) > td:nth-child("+count+")",selector+=", > tfoot > tr:not(.flextable-row-detail) > td:nth-child("+count+")",selector+=", > colgroup > col:nth-child("+count+")",first=!1}),selector+=', > thead > tr[data-group-row="true"] > th[data-group="'+data.group+'"]';var $column=$table.find(selector).add(this);if(!1===data.hide[breakpointName]?$column.show():$column.hide(),1==$table.find("> thead > tr.flextable-group-row").length){var $groupcols=$table.find('> thead > tr:last-child > th[data-group="'+data.group+'"]:visible, > thead > tr:last-child > th[data-group="'+data.group+'"]:visible'),$group=$table.find('> thead > tr.flextable-group-row > th[data-group="'+data.group+'"], > thead > tr.flextable-group-row > td[data-group="'+data.group+'"]'),groupspan=0;$.each($groupcols,function(){groupspan+=parseInt($(this).attr("colspan")||1,10)}),groupspan>0?$group.attr("colspan",groupspan).show():$group.hide()}}).end().find("> tbody > tr.flextable-detail-show").each(function(){ft.createOrUpdateDetailRow(this)}),$table.find("> tbody > tr.flextable-detail-show:visible").each(function(){var $next=$(this).next();$next.hasClass("flextable-row-detail")&&("default"!=breakpointName||hasBreakpointFired?$next.show():$next.hide())}),$table.find("> thead > tr > th.flextable-last-column, > tbody > tr > td.flextable-last-column").removeClass("flextable-last-column"),$table.find("> thead > tr > th.flextable-first-column, > tbody > tr > td.flextable-first-column").removeClass("flextable-first-column"),$table.find("> thead > tr, > tbody > tr").find("> th:visible:last, > td:visible:last:not(.flextable-cell-detail)").addClass("flextable-last-column").end().find("> th:visible:first, > td:visible:first:not(.flextable-cell-detail)").addClass("flextable-first-column"),ft.raise("flextable_breakpoint_"+breakpointName,{info:info})}ft.raise("flextable_resized",{old:pinfo,info:info})},ft.toggleDetail=function(actualRow){var $row=$(actualRow),created=ft.createOrUpdateDetailRow($row.get(0)),$next=$row.next();!created&&$next.is(":visible")?($row.removeClass("flextable-detail-show"),$next.hasClass("flextable-row-detail")&&$next.hide(),$next.attr("aria-hidden","true")):($row.addClass("flextable-detail-show"),$next.show(),$next.attr("aria-hidden","false"))},ft.toggleCustomDetail=function(actualRow,innerTable,control,btn){var $row=$(actualRow),$next=$row.next(),$innerTable=$(innerTable),$control=$(control),open=!1;open=!$next.is(":visible");var colspan=$row.find("> td:visible").length,exists=$next.hasClass("flextable-row-detail");exists&&($next.remove(),exists=!1),exists||($next=$('<tr class="flextable-row-detail custom-detail"><td class="flextable-cell-detail"><div class="flextable-row-detail-inner"><table>'+$innerTable.html()+"</table></div></td></tr>"),$row.after($next),open=!0),$next.find("> td:first").attr("colspan",colspan),open?($control.removeClass("close").addClass("open"),$next.removeClass("close").addClass("open"),btn.unbind("click.flextable").bind("click.flextable",function(e){$next.remove(),$control.removeClass("open").addClass("close"),btn.unbind("click.flextable").bind("click.flextable",function(e){ft.toggleCustomDetail(actualRow,innerTable,control,btn)})})):($control.removeClass("open").addClass("close"),$next.removeClass("open").addClass("close"))},ft.getColumnFromTdIndex=function(index){var result=null;for(var column in ft.columns)if($.inArray(index,ft.columns[column].matches)>=0){result=ft.columns[column];break}return result},ft.createOrUpdateDetailRow=function(actualRow){var $detail,$row=$(actualRow),$next=$row.next(),values=[];if($row.is(":hidden"))return!1;if($row.find("> td:hidden").each(function(){var index=$(this).index(),column=ft.getColumnFromTdIndex(index),name=column.name;return!0===column.ignore||(values.push({name:name,value:ft.parse(this,column),display:$.trim($(this).html()),group:column.group,groupName:column.groupName}),!0)}),0===values.length)return!1;var colspan=$row.find("> td:visible").length,exists=$next.hasClass("flextable-row-detail");return exists||($next=$('<tr class="flextable-row-detail"><td class="flextable-cell-detail"><div class="flextable-row-detail-inner"></div></td></tr>'),$row.after($next)),$next.find("> td:first").attr("colspan",colspan),$detail=$next.find(".flextable-row-detail-inner").empty(),opt.createDetail($detail,values),!exists},ft.createCustomRow=function(actualRow){var $row=$(actualRow);$row.next();if($row.is(":hidden"))return!1},ft.raise=function(eventName,args){args=args||{};var def={ft:ft};$.extend(!0,def,args);var e=$.Event(eventName,def);return e.ft||$.extend(!0,e,def),$(ft.table).trigger(e),e},ft.init(),$(ft.table).css("display","none").css("display",""),ft}w.flextable={options:{delay:100,breakpoints:{"phone-portrait":320,"phone-landscape":480,"tablet-portrait":768,"tablet-landscape":1024,"desktop-full":1600,always:1e4},parsers:{alpha:function(cell){return $(cell).data("value")||$.trim($(cell).text())}},selectorEnabled:!0,toggleSelector:" > tbody .flextable-control a",customToggleSelector:"> tbody > tr > td .custom-flextable-control a",createDetail:function(element,data){for(var groups={_none:{name:null,data:[]}},i=0;i<data.length;i++){var groupid=data[i].group;null!==groupid?(groupid in groups||(groups[groupid]={name:data[i].groupName,data:[]}),groups[groupid].data.push(data[i])):groups._none.data.push(data[i])}for(var group in groups)if(0!==groups[group].data.length){"_none"!=group&&element.append("<h4>"+groups[group].name+"</h4>");for(var j=0;j<groups[group].data.length;j++)if(groups[group].data[j].name.length>0){if(element.append("<div><strong>"+groups[group].data[j].name+"</strong>: "+groups[group].data[j].display+"</div>"),this.isHtml(groups[group].data[j].display)){var $custom=$(groups[group].data[j].display),$elem=element.find(".custom-flextable-control");$custom.hasClass("custom-flextable-control")&&this.bindCustomInnerToggle($elem)}}else element.append("<div>"+groups[group].data[j].display+"</div>")}},isHtml:function(str){var a=document.createElement("div");a.innerHTML=str;for(var c=a.childNodes,i=c.length;i--;)if(1==c[i].nodeType)return!0;return!1},bindCustomInnerToggle:function(element){$(element).unbind("click.flextable").bind("click.flextable",function(e){e.preventDefault(),element.next().is(":visible")?(element.removeClass("open").addClass("close"),element.next().hide()):(element.removeClass("close").addClass("open"),element.next().show())})},classes:{loading:"flextable-loading",loaded:"flextable-loaded",sorted:"flextable-sorted",descending:"flextable-sorted-desc",indicator:"flextable-sort-indicator"},debug:!0},version:{major:0,minor:1,toString:function(){return w.flextable.version.major+"."+w.flextable.version.minor},parse:function(str){return version=/(\d+)\.?(\d+)?\.?(\d+)?/.exec(str),{major:parseInt(version[1],10)||0,minor:parseInt(version[2],10)||0,patch:parseInt(version[3],10)||0}}},plugins:{_validate:function(plugin){return"string"!=typeof plugin.name?(!0===w.flextable.options.debug&&console.error('Validation failed, plugin does not implement a string property called "name".',plugin),!1):$.isFunction(plugin.init)?(!0===w.flextable.options.debug&&console.log('Validation succeeded for plugin "'+plugin.name+'".',plugin),!0):(!0===w.flextable.options.debug&&console.error('Validation failed, plugin "'+plugin.name+'" does not implement a function called "init".',plugin),!1)},registered:[],register:function(plugin,options){w.flextable.plugins._validate(plugin)&&(w.flextable.plugins.registered.push(plugin),void 0!==options&&"object"==typeof options&&$.extend(!0,w.flextable.options,options),!0===w.flextable.options.debug&&console.log('Plugin "'+plugin.name+'" has been registered with the Foobox.',plugin))},init:function(instance){for(var i=0;i<w.flextable.plugins.registered.length;i++)try{w.flextable.plugins.registered[i].init(instance)}catch(err){!0===w.flextable.options.debug&&console.error(err)}}}};var instanceCount=0;$.fn.flextable=function(options){options=options||{};var o=$.extend(!0,{},w.flextable.options,options);return this.each(function(){instanceCount++,this.flextable=new Flextable(this,o,instanceCount)})}}(jQuery,window),head.ready(function(){$("#tables-example, #product-model-tip").find(".flextable").flextable(),initializeFlexTableEventHandlers()}),head.ready(function(){initializeTabs()});var CatNS=CatNS||{};CatNS.tpl={templates:{},loadTemplates:function(names,callback){var that=this,loadTemplate=function(index){var name=names[index];console.log("Loading template: "+name),$.get(tplPath+name+".html",function(data){that.templates[name]=data,index++,index<names.length?loadTemplate(index):callback()})};loadTemplate(0)},get:function(name){return this.templates[name]}},head.ready(function(){initializeToggles()}),head.ready(function(){initializeToolTips()}),window.console||(console={log:function(){}});var CatNS=CatNS||{},CATDealerModel=Backbone.Model.extend({defaults:{intId:"dealerId",name:"dealer name",street:"street",city:"city",state:"state",locations:[],encryptedDealerCode:"",parentDealerCode:""},initialize:function(){}}),CATDealerCollection=Backbone.Collection.extend({model:CATDealerModel,initialize:function(){},fetch:function(latlng,boo){var collection=this,serviceObj={resourceId:CAT_SERVICES_NAME.DEALER_IDS,data:{lat:latlng.lat,lng:latlng.lng,appid:window._cat_drl_loc_app_id,app_url:window._cat_drl_loc_app_url,app_param:window._cat_drl_loc_app_param,host_protocal:"https:"==document.location.protocol?"https:":"http:"}};console.log("Dealer service called",serviceObj),amplify.request({resourceId:serviceObj.resourceId,data:serviceObj.data,success:function(data){var dealersRaw=dealerList["dealerlocation-array"];_.each(dealersRaw,function(value,idx){dealersRaw[idx].encryptedDealerCode=$.trim(value.encryptedDealerCode),dealersRaw[idx].parentDealerCode=$.trim(value.parentDealerCode)}),_.sortBy(dealersRaw,"distanceInMiles");var dealersGroup=_.groupBy(dealersRaw,"parentDealerCode"),parentsIds=_.keys(dealersGroup),dealersCollection=[],dealersRawCollection=[];_.each(parentsIds,function(store){var rawMainDealer=_.where(dealersRaw,{encryptedDealerCode:store});if(void 0!==rawMainDealer[0]&&rawMainDealer.length>0){var rawDealer=new CATDealerModel(rawMainDealer[0]);rawDealer.set("locations",dealersGroup[store]);var closestBranch=dealersGroup[store][0];rawDealer.set("distanceInMilesClosestBranch",void 0!=closestBranch?closestBranch.distanceInMiles:rawDealer.get("distanceInMiles")),dealersRawCollection.push(rawDealer)}}),dealersRawCollection=_.sortBy(dealersRawCollection,function(dealer){return dealer.get("distanceInMilesClosestBranch")});var reducedRawCollection=dealersRawCollection.slice(0,5);console.log("DEALERS RAW COLLECTION",reducedRawCollection),amplify.store(CAT_STORE.DEALERS_RAW,reducedRawCollection);var storedDealers=amplify.store(CAT_STORE.CAT_CATALOG_DEALERS);_.isEmpty(storedDealers)||(parentsIds=_.intersection(parentsIds,storedDealers)),_.each(parentsIds,function(store){var mainDealer=_.where(dealersRaw,{encryptedDealerCode:store});if(void 0!==mainDealer[0]&&mainDealer.length>0){var dealer=new CATDealerModel(mainDealer[0]);dealer.set("locations",dealersGroup[store]);var closestBranch=dealersGroup[store][0];dealer.set("distanceInMilesClosestBranch",void 0!=closestBranch?closestBranch.distanceInMiles:dealer.get("distanceInMiles")),dealersCollection.push(dealer)}}),dealersCollection=_.sortBy(dealersCollection,function(dealer){return dealer.get("distanceInMilesClosestBranch")});var reducedCollection=dealersCollection.slice(0,5);collection.reset(reducedCollection),collection.size()?amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL):amplify.publish(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL),amplify.publish(CAT_EVENTS.DEALERS_LIST_SUCCESS,collection)},error:function(message,level){console.log("error")}})},getDealers:function(latlang){amplify.publish(CAT_EVENTS.DEALERS_SEARCHING),this.fetch(latlang)}}),CATCompetitorModel=Backbone.Model.extend({defaults:{Machine_ID:"0",Manufacturer_ID:"0",Manufacturer:"xx",Model:"740",Discontinued:"0",Tier_ID:"3",Sort_Display:"39500"}}),CATCompetitorDataHeader=Backbone.Model.extend({defaults:{Label:"Backhoe type",DataType:"A",Data:[{Machine_ID:"0",Region_ID:"0",Manufacturer:"",Model:"",Tier_ID:"0",Tier:"",Discontinued:"0"}]}}),CATCompetitorDataModel=Backbone.Model.extend({defaults:{Label:"Backhoe type",DataType:"A",Unit:"",Data:[]},initialize:function(){var match,i,len,k,dataLen,unit=this.get("Unit"),units=[],pattern=/\[(.*?)\]/,dLen=this.get("Data").length;if(""!==unit&&unit.length>3){var end=unit.indexOf(" [");for(end>-1&&(units.push(unit.substring(0,end-1)),match=unit.match(pattern),match.length>0&&units.push(match[1])),i=0;i<dLen;i++)this.get("Data")[i]=function(data){if(""===data)return"";var end=data.indexOf(" ["),values=[];if(end>-1&&(values.push(data.substring(0,end-1)),match=data.match(pattern),match&&match.length>0&&values.push(match[1]),len=units.length,dataLen=values.length,len===dataLen))for(k=0;k<len;k++)values[k]=values[k]+" "+units[k];return values}(this.get("Data")[i]["Column "+i])}else for(i=0;i<dLen;i++)this.get("Data")[i]=this.get("Data")[i]["Column "+i]}}),CATCompetitorDataCollection=Backbone.Collection.extend({model:function(attrs,options){switch(attrs.Label){case"MACHINES":return new CATCompetitorDataHeader(attrs,options);default:return new CATCompetitorDataModel(attrs,options)}},fetch:function(params){console.log("fetch function: params",params);var collection=this;amplify.request({resourceId:CAT_SERVICES_NAME.COMPETITORS_DATA,data:{mids:params.ids,rgids:params.rgids},success:function(data){collection.reset(data),amplify.publish(CAT_EVENTS.COMPETITORS_DATA_SUCCESS,collection)},error:function(message,status){amplify.publish(CAT_EVENTS.SERVICE_ERROR,status)}})},getHeader:function(){var header=this.shift();return console.log("getHeader: header:",header),header},getData:function(){return this.slice(0)}}),CATCompetitorCollection=Backbone.Collection.extend({model:CATCompetitorModel,initialize:function(){console.log("initialize collection.length=",this.length)},fetch:function(params,catSpecCheckId){var collection=this;amplify.request({resourceId:CAT_SERVICES_NAME.COMPETITORS,data:{mid:params.id,rgids:params.rgids},success:function(data){collection.reset(data),console.log("before exclude collection.length=",collection.length),collection.exclude(catSpecCheckId),console.log("after exclude collection.length=",collection.length),console.log("collection listings:",collection.pluck("Manufacturer"),collection.pluck("Machine_ID")),amplify.publish(CAT_EVENTS.COMPETITORS_SUCCESS,collection)},error:function(message,status){console.log("2. >>>>>competitor ERROR: msg=",message," / status=",status),amplify.publish(CAT_EVENTS.SERVICE_ERROR,status)}})},exclude:function(catSpecCheckId){var collection=this,excludeItems=[];console.log(".....exclude catSpecCheckId = ",catSpecCheckId),void 0===catSpecCheckId&&(catSpecCheckId="5"),this.each(function(competitor){console.log("manufacturer:",competitor.get("Manufacturer")," / Manufacturer_ID=",competitor.get("Manufacturer_ID")," / Model:",competitor.get("Machine_ID")),competitor.get("Manufacturer_ID")!=catSpecCheckId&&"1"!=competitor.get("Discontinued")||(console.log("...remove:",competitor.get("Manufacturer"),"-",competitor.get("Machine_ID")),excludeItems.push(competitor))}),console.log("removing items:",excludeItems);for(var len=excludeItems.length,i=0;i<len;i++)collection.remove(excludeItems[i])},getGroups:function(){console.log("getGroups: len=",this.length,this.pluck("Manufacturer"));var brand,groups=this.groupBy(function(model){return model.get("Manufacturer")}),result=[];for(brand in groups)result.push({label:brand,list:groups[brand]});return result},removeSelectedModels:function(ids){var collection=this,selectedModels=[],len=ids.length;console.log("collection before remove:",collection);for(var i=0;i<len;i++){var model=collection.findWhere({Machine_ID:ids[i]+""});void 0!==model&&(selectedModels.push(model),collection.remove(model))}return console.log("selectedModels:",selectedModels),console.log("collection after remove selected model:",collection.pluck("Manufacturer")),selectedModels},getTop2Models:function(){var top2Models=[],collection=this,cnt=0;collection.length>0&&collection.each(function(competitor){if(!(cnt<2))return!1;top2Models.push(competitor),cnt+=1});for(var i=0;i<cnt;i++)collection.remove(top2Models[i]);return console.log("top2Models:",top2Models),console.log("collection:",collection.pluck("Manufacturer")),top2Models}}),CATProductDetailModel=Backbone.Model.extend({defaults:{pid:"0",itemtype:"new/rental",quantity:1,path:"path",startDate:"",endDate:"",delivered:!1,did:"0",dName:"dealer name",dAddress1:"Address line 1",dAddress2:"Address line 2",dPhone:"000-000-0000"}}),CATProductDetailView=Backbone.View.extend({model:CATProductDetailModel,initialize:function(){console.log("product detail view",this.$el)},events:{"click .cart-add-button":"addToCart"},addToCart:function(evt){evt.preventDefault(),
CatNS.CATEnhanceModel.addItemToCart(this.model.attributes)}});CatNS.CATEnhanceModel={dealers:new CATDealerCollection,dealersSelected:[],competitors:new CATCompetitorCollection,competitorsData:new CATCompetitorDataCollection,initialize:function(){amplify.subscribe(CAT_EVENTS.DEALERS_LIST_SUCCESS,this.onDealersUpdate),amplify.subscribe(CAT_EVENTS.DEALER_SEARCH_SUCCESS,this.onDealerSearch),amplify.subscribe(CAT_EVENTS.DEALER_SELECTED,this,this.onDealerSelected),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET,this,this.onFilterDealerReset);var family=$("#cat-family-name").val();$("#cat-family-name")&&amplify.store(CAT_STORE.CAT_FAMILY_NAME,family),this.dealersSelected=amplify.store(CAT_STORE.DEALER_SELECTED)},onFilterDealerReset:function(){this.dealersSelected=[]},getDealerLocation:function(address){var _that=this,geo=new google.maps.Geocoder;console.log("getDealerLocation",address),geo.geocode({address:address},function(results,status){if(status!=google.maps.GeocoderStatus.OK)return amplify.publish(CAT_EVENTS.SERVICE_ERROR,{message:"Geocode was not successful for the following reason: "+status}),amplify.publish(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL),amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE),amplify.publish(CAT_EVENTS.GOOGLE_GEO_ERROR),!1;var latLng=results[0].geometry.location;_that.getDealers({lat:latLng.lat(),lng:latLng.lng()},!0),amplify.publish(CAT_EVENTS.DEALER_SEARCH_SUCCESS,address)})},getDealers:function(latlng,force){!force&&amplify.store(CAT_STORE.DEALERS)?(console.log("getting dealers from storage"),this.dealers.reset(amplify.store(CAT_STORE.DEALERS))):(console.log("requesting dealers service",CAT_SERVICES_URL.DEALER_IDS),this.dealers.getDealers(latlng))},onDealersUpdate:function(data){amplify.store(CAT_STORE.DEALERS,data.toJSON()),amplify.store(CAT_STORE.DEALER_SELECTED,null)},onDealerSearch:function(data){amplify.store(CAT_STORE.DEALERS_SEARCHED,data)},setDealer:function(data){var dealer=data.dealer,exist=0!==_.where(this.dealersSelected,{encryptedDealerCode:dealer.encryptedDealerCode}).length;if(this.dealersSelected||(this.dealersSelected=[]),exist?data.value?this.dealersSelected.push(dealer):this.dealersSelected=_.reject(this.dealersSelected,function(item){return item.encryptedDealerCode===dealer.encryptedDealerCode}):this.dealersSelected.push(dealer),amplify.store(CAT_STORE.DEALER_SELECTED,this.dealersSelected),_.isEmpty(amplify.store(CAT_STORE.DEALER_SELECTED)))amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null);else{var sortByDistance=_.sortBy(this.dealersSelected,function(dealer){return dealer.distanceInMiles});amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,sortByDistance[0])}},onDealerSelected:function(data,isRaw){console.log("MODEL ON DEALER SELECTED",data,isRaw),isRaw||this.setDealer(data)},getCompetitors:function(params){this.competitors.fetch(params)},getCompetitorsData:function(params){this.competitorsData.fetch(params)},addItemToCart:function(params){var data={action:"add",pid:params.pid,itemtype:params.itemtype,quantity:1,path:params.path,startDate:params.startDate,endDate:params.endDate,delivered:params.delivered,did:params.did,dName:params.dName,dAddress1:params.dAddress1,dAddress2:params.dAddress2,dPhone:params.dPhone};console.log("sending",data),amplify.request({resourceId:CAT_SERVICES_NAME.CART,data:data,success:function(data){console.log("RESPONSE ADD",data),"success"===data.result?(amplify.publish(CAT_EVENTS.CART_ADD_SUCCESS,data),window.location="/content/finning/en_US/quote-cart-page.html"):amplify.publish(CAT_EVENTS.SERVICE_ERROR,data)},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})}};var CAT_STORE={DEALERS:"DEALERS",DEALERS_RAW:"DEALERS_RAW",DEALERS_SEARCHED:"DEALERS_SEARCHED",DEALER_SELECTED:"DEALER_SELECTED",DETAIL_DEALER_SELECTED:"DETAIL_DEALER_SELECTED",CAT_FAMILY_ID:"CAT_FAMILY_ID",CAT_CATALOG_FACETS:"CAT_CATALOG_FACETS",CAT_CATALOG_DEALERS_FACETS:"CAT_CATALOG_DEALERS_FACETS",CAT_CATALOG_DEALERS:"CAT_CATALOG_DEALERS",CAT_FAMILY_PAGE:"CAT_FAMILY_PAGE",CURRENCY:"CURRENCY",CAT_CURRENT_PAGETYPE:"CAT_CURRENT_PAGETYPE"},CAT_EVENTS={SERVICE_ERROR:"SERVICE_ERROR",DEALERS_LIST_SUCCESS:"DEALER_LIST_SUCCESS",DEALER_SEARCH_SUCCESS:"DEALER_SEARCH_SUCESS",DEALER_SELECTED:"DEALER_SELECTED",COMPETITORS_SUCCESS:"COMPETITORS_LIST_SUCCESS",COMPETITORS_DATA_SUCCESS:"COMPETITORS__DATALIST_SUCCESS",CART_DELETE_SUCCESS:"CART_DELETE_SUCCESS",CART_ADD_SUCCESS:"CART_ADD_SUCCESS",CART_UPDATE_SUCCESS:"CART_UPDATE_SUCCESS",CART_DELETE_ITEM:"CART_DELETE_ITEM",CATALOG_SUCCESS:"CATALOG_SUCCESS",CATALOG_SIDEKICK_SUCCESS:"CATALOG_SIDEKICK_SUCCESS",CATALOG_SHOW_SIDEKICK:"CATALOG_SHOW_SIDEKICK",CATALOG_HIDE_SIDEKICK:"CATALOG_HIDE_SIDEKICK",CATALOG_PAGINATION:"CATALOG_PAGINATION",CATALOG_RENDER_DONE:"CATALOG_RENDER_DONE",CATALOG_FILTER:"CATALOG_FILTER",CATALOG_FILTER_UPDATE:"CATALOG_FILTER_UPDATE",CATALOG_FILTER_RESET:"CATALOG_FILTER_RESET",CATALOG_FILTER_REFRESH:"CATALOG_FILTER_REFRESH",CATALOG_FILTER_DEALER_RESET:"CATALOG_FILTER_DEALER_RESET",CATALOG_FILTER_DEEPLINK:"CATALOG_FILTER_DEEPLINK",CATALOG_PAGE_DEEPLINK:"CATALOG_PAGE_DEEPLINK",CAT_SPINNER_HIDE:"CAT_SPINNER_HIDE",CAT_SPINNER_SHOW:"CAT_SPINNER_SHOW",CAT_SPINNER_TIME_OUT:"CAT_SPINNER_TIME_OUT",CAT_SPINNER_ERROR:"CAT_SPINNER_ERROR",TIP_SUCCESS:"TIP_SUCCESS",CAT_DEALERS_DETAIL_SUCCESS:"CAT_DEALERS_DETAIL_SUCCESS",DEALER_RATES_SUCCESS:"DEALER_RATES_SUCCESS",DEALER_CURRENCY_SEARCH:"DEALER_CURRENCY_SEARCH",DEALER_RATES_NO_RATES:"DDEALER_RATES_NO_RATES",DEALERS_BY_PRODUCT_SUCCESS:"DEALERS_BY_PRODUCT_SUCCESS",DEALERS_NEW_SEARCH:"DEALERS_NEW_SEARCH",DEALERS_NOT_AVAILABLE_RENTAL:"DEALERS_NOT_AVAILABLE",DEALERS_AVAILABLE_RENTAL:"DEALERS_AVAILABLE_RENTAL",DEALERS_SEARCHING:"DEALERS_SEARCHING",GOOGLE_GEO_ERROR:"GOOGLE_GEO_ERROR",HIDE_DEALER_LIST:"HIDE_DEALER_LIST",SHOW_DEALER_LIST:"SHOW_DEALER_LIST",FACETED_URL:"FACETED_URL",FAMILY_PRICE_DROPDOWN:"FAMILY_PRICE_DROPDOWN"},CAT_LANG="en",CAT_SERVICES_URL={DEALER_IDS:"{host_protocal}//{app_url}/dealerlocator/jsonService/V1/latlonp/{lat}/{lng}/{app_param}/////{appid}",CQ_DEALER_IDS:"#get_from_kapil",CART:"http://localhost:4502/services/updatequotecart",COMPETITORS:window.location.pathname.split(".")[0]+".speccheck",COMPETITORS_DATA:window.location.pathname.split(".")[0]+".speccheck",CATALOG_DATA:"/_jcr_content.feed.json",DEALERS_RATES:"/services/dealerRates?data=",DEALERS_BY_PRODUCT:"/services/dealersByProduct?data="},CAT_SERVICES_NAME={DEALER_IDS:"DEALER_IDS",CQ_DEALER_IDS:"CQ_DEALER_IDS",CART:"CART",COMPETITORS:"COMPETITORS",COMPETITORS_DATA:"COMPETITORS_DATA",CATALOG_DATA:"CATALOG_DATA",TIP_DATA:"TIP_DATA",DEALERS_DETAIL:"DEALERS_DETAIL",DEALERS_RATES:"DEALERS_RATES",DEALERS_BY_PRODUCT:"DEALERS_BY_PRODUCT"};amplify.request.define(CAT_SERVICES_NAME.CART,"ajax",{url:CAT_SERVICES_URL.CART,dataType:"json",type:"POST"}),amplify.request.define(CAT_SERVICES_NAME.DEALER_IDS,"ajax",{url:CAT_SERVICES_URL.DEALER_IDS,dataType:"script",type:"GET"}),amplify.request.define(CAT_SERVICES_NAME.CQ_DEALER_IDS,"ajax",{url:CAT_SERVICES_URL.CQ_DEALER_IDS,dataType:"jsonp",type:"GET",contentType:"application/javascript"}),amplify.request.define(CAT_SERVICES_NAME.COMPETITORS,"ajax",{url:CAT_SERVICES_URL.COMPETITORS,dataType:"json",type:"GET",contentType:"application/javascript"}),amplify.request.define(CAT_SERVICES_NAME.COMPETITORS_DATA,"ajax",{url:CAT_SERVICES_URL.COMPETITORS_DATA,dataType:"json",type:"GET",contentType:"application/javascript"}),$.ajaxSetup({timeout:window._cat_ajax_timeout}),$(document).ajaxSend(function(evt,jqxhr,settings){window._cat_ajax_timedout=!1}),$(document).ajaxError(function(evt,jqxhr,settings,throwError){"timeout"===throwError&&(window._cat_ajax_timedout=!0)}),amplify.subscribe(CAT_EVENTS.SERVICE_ERROR,function(status){"timeout"===status&&(window._cat_ajax_timedout=!0)}),jQuery.extend({getQueryParameters:function(){for(var queries=document.location.search.replace(/(^\?)/,"").split("&"),len=queries.length,obj={},i=0;i<len;i++){var pair=queries[i].split("="),key=decodeURIComponent(pair[0]),val=decodeURIComponent(pair[1]);obj[key]=val}return obj}});var CatNS=CatNS||{};CatNS.common={},head.ready(function(){CatNS.common.addLinkEvents=function(){console.log("addLinkEvents"),$(".back-link").length&&(""===document.referrer&&history.length<=1?$(".back-link").hide():$(".back-link").on("click",function(evt){return evt.preventDefault(),history.go(-1),!1})),$(".print").on("click",function(evt){evt.preventDefault(),window.print()})},CatNS.common.catSpinner={html:'<div id="cat-spinner" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-body"><div class="spinning"><span class="spinner"></span></div></div></div>',$el:null,$focusEl:null,addSpinner:function(){null===CatNS.common.catSpinner.$el&&($("#cat-spinner").length<1?(CatNS.common.catSpinner.$el=$(CatNS.common.catSpinner.html).appendTo(document.body),console.log("append Spinner to body")):(CatNS.common.catSpinner.$el=$("#cat-spinner"),console.log("got existing spinner")),CatNS.common.catSpinner.$el.on("hidden",function(){CatNS.common.catSpinner.$focusEl&&(console.log("focus on elment:"),CatNS.common.catSpinner.$focusEl.focus())}))},show:function(){CatNS.common.catSpinner.addSpinner(),CatNS.common.catSpinner.$el.modal("show")},hide:function(focusEl){CatNS.common.catSpinner.addSpinner(),void 0!==focusEl&&(CatNS.common.catSpinner.$focusEl=$(focusEl)),CatNS.common.catSpinner.$el.modal("hide")},error:function(el){CatNS.common.catSpinner.hide(),$(el).show().focus()},init:function(){amplify.subscribe(CAT_EVENTS.CAT_SPINNER_SHOW,CatNS.common.catSpinner.show),amplify.subscribe(CAT_EVENTS.CAT_SPINNER_HIDE,CatNS.common.catSpinner.hide),amplify.subscribe(CAT_EVENTS.CAT_SPINNER_TIME_OUT,CatNS.common.catSpinner.timedOut),amplify.subscribe(CAT_EVENTS.CAT_SPINNER_ERROR,CatNS.common.catSpinner.error)}},CatNS.common.init=function(){CatNS.common.addLinkEvents(),CatNS.common.catSpinner.init()},CatNS.common.init()});var CatNS=CatNS||{};CatNS.compare={},head.ready(function(){CatNS.compare.pagePath=location.pathname,CatNS.compare.dropdown=function(){function pageRefresh(){var params={},idParam="productId",queryStr="",ids="",cnt=0;return __cq_var.compareCompetitor&&__cq_var.compareCompetitor.info&&(idParam="modelId"),location.search?params=$.getQueryParameters():params[idParam]="",console.log("page params=",params),$(dropdown+dropdwonTitle).each(function(index){ids+=(index>0?",":"")+$(this).attr("data-model-id")}),console.log("ids=",ids),$.each(params,function(key,value){key.toLowerCase()===idParam.toLowerCase()&&(value=ids),queryStr+=(0===cnt?"?":"&")+key+"="+value,cnt+=1}),location.pathname+queryStr}function addDropdownEvent($dropdown){var $linkItems=$dropdown.find(".dropdown-menu li a");$linkItems.length<1||$linkItems.on("click",function(evt){var $this=$(this),$h5=$dropdown.find("h5"),dataLen=dataIds.length;if($this.parents("li").hasClass("disabled")||$this.parents("li").hasClass("active"))return evt.preventDefault(),!1;for(var i=0;i<dataLen;i++){var val=$this.data(dataIds[i]);void 0!==val&&("model-id"===dataIds[i]?($h5.find(".dropdown-display").html($this.text()),$h5.attr("data-"+dataIds[i],val)):$h5.find("."+dataIds[i]).html(val))}var url=pageRefresh();return $this.attr("href",url),!0})}var dropdown=".model-tab-content .dropdown",dropdwonTitle=" a h5",dataIds=["model-brand","model-id"];console.log(">>adding compare dropdown"),$(dropdown).each(function(index){console.log("adding dropdown #",index),addDropdownEvent($(this))})},CatNS.compare.modelTabs=function(){console.log("modelTabs");var $tabModule=$(".compare-model-tabs");if(!($tabModule.length<1)){var $tabs=$tabModule.find(".model-tab");$tabs.on("click",".tab-toggle",function(evt){console.log(evt),evt.preventDefault();var $tabsContent=$tabModule.find(".model-tab-content"),$thisTab=$(evt.delegateTarget);$thisTab.hasClass("selected")&&(window.location=$thisTab.find(".tab-link").attr("href")),$tabs.removeClass("selected"),$thisTab.addClass("selected"),$tabsContent.removeClass("selected"),$tabsContent.filter("#"+$(this).data("target")).addClass("selected")})}},CatNS.compare.affix=function(){function removeStickyHeader(){$headerGhost.removeClass("show")}var $headerTable=$("#compare-table-header"),$headerGhost=$("#table-header-ghost");$headerTable.outerHeight(!0);$headerTable.affix({offset:{top:function(){return this.top=Math.round($headerTable.offset().top)},bottom:function(){var fromTop=$headerTable.offset().top,stopOn=($(document).height(),$headerTable.outerHeight(),$(document).height()-$("footer").offset().top+($headerTable.outerHeight()-$headerTable.height()));return this.bottom=Math.round(stopOn)}}}),$headerTable.on("affix.bs.affix",function(){console.log("----- affix ---"),$(this).width()}),$headerTable.on("affixed.bs.affix",function(){console.log("----- affix ---"),$headerGhost.addClass("show"),$headerGhost.height($headerTable.height()),$(this).width()}),$headerTable.on("affixed-top.bs.affix",function(){console.log("affix > top"),removeStickyHeader()}),$headerTable.on("affix-bottom.bs.affix",function(){console.log("affix > btm"),$(this).width()})},CatNS.compare.init=function(){$(".compare").length<1||(CatNS.compare.pagePath=$(".cq-page-path").data("path"),CatNS.compare.dropdown(),CatNS.compare.modelTabs(),CatNS.compare.affix())},CatNS.compare.init()});var CatNS=CatNS||{};CatNS.datepicker={init:function(){}},head.ready(function(){CatNS.datepicker.init()});var CatNS=CatNS||{},CATFacetedFilterModel=Backbone.Model.extend({defaults:{idFilter:"0",name:[],url:"url",type:"facet/family",count:0,groupName:"name"}}),CATFacetedFilterCollection=Backbone.Collection.extend({model:CATFacetedFilterModel}),CATFacetedFilterListView=Backbone.View.extend({model:CATFacetedFilterCollection,initialize:function(){var list=$(".filter-boxes"),collection=($(".filter-radios"),this.model);collection.reset(),_.each(list,function(group){var filters=$(group).find(".filter");_.each(filters,function(filter){var filterModel=new CATFacetedFilterModel({idFilter:$(filter).attr("data-id"),name:[$($(filter).find("label")[1]).text(),$($(filter).find("label")[0]).text()],url:$(filter).attr("data-url"),type:$(filter).attr("data-type"),groupName:$(filter).parent().attr("role")});collection.add(filterModel);new CATFacetedFilterView({model:collection.get(filterModel),el:$(filter)})})})}}),backToFirstPage=function(){var viewState=JSON.parse(localStorage.getItem("viewState"));null!=viewState&&viewState.familyID==amplify.store(CAT_STORE.CAT_FAMILY_ID)&&viewState.onViewAll?$("html, body").animate({scrollTop:0},1e3):getCurrentPage(1)},initializeSerialNumber=function(){Granite.I18n.setLocale($("meta[property='og:locale']").attr("content")),$("#serialNumber-clear-all").hide(),$("#serial-number-select-submit").click(function(e){e.preventDefault(),backToFirstPage(),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:"serialNumber",type:"facet",groupName:"serialNumber",primary:!0,value:!0,serialNumber:$("#serial-number-select").val()})}),$("#serialNumber-clear-all").click(function(event){event.preventDefault(),backToFirstPage(),$("#serialNumber-clear-all").hide(),$("#serial-number-select").val(""),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:"serialNumber",type:"clear",groupName:"serialNumber",primary:!0,value:!0})})},initializeRangeInputFilter=function(filterName){$("#"+filterName+"-range-input-submit").click(function(e){e.preventDefault(),backToFirstPage(),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:filterName,type:"facet",groupName:filterName+"rangeInput",primary:!0,value:!0,rangeInputMin:$("#"+filterName+"-range-input-min").val()/1,rangeInputMax:$("#"+filterName+"-range-input-max").val()/1})})},updateSliderWithRangeInput=function(filterName){var filterSlider=$("#"+filterName+"-range-select").data("ionRangeSlider");hasRangeInputFilter(filterName)&&filterSlider.update({from:$("#"+filterName+"-range-input-min").val()/1,to:$("#"+filterName+"-range-input-max").val()/1})},hasRangeInputFilter=function(filterName){var min=$("#"+filterName+"-range-input-min").val()/1,max=$("#"+filterName+"-range-input-max").val()/1;return!isNaN(min)&&!isNaN(max)&&max>=min},CATFacetedFilterView=Backbone.View.extend({model:CATFacetedFilterModel,events:{"click label":"onFilterClick","change input":"onFilterClick"},initialize:function(){var self=this;this.model.set("groupName",this.$el.parent().attr("role")),this.onFilterReset(),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_RESET,this,self.onFilterReset),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,this,self.onDeeplink),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_UPDATE,function(filteredCollection,fullCollection,groupName,dealersSelected){if("facet"===self.model.get("type")||"family"===self.model.get("type"))if(window._cat_primary_facet===self.model.get("groupName")){var facets=_.values(amplify.store(CAT_STORE.CAT_CATALOG_FACETS));_.values(_.groupBy(facets,"groupName")).length>1?self.validateFacetQuantity(filteredCollection,self.model.get("type"),groupName):self.addFamilyTypeSimpleCount(fullCollection)}else self.validateFacetQuantity(filteredCollection,self.model.get("type"),groupName)})},onDeeplink:function(params){var self=this;if(console.log("=====>",params,this.model),params===this.model.get("idFilter"))this.$el.addClass("selected"),this.$el.find("input").prop("checked",!0),setTimeout(function(){self.$el.parent().parent().parent().addClass("show").siblings(".facet-filter").addClass("open"),_.isEmpty(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))?window._cat_primary_facet=this.model?this.model.get("groupName"):"facet-type":window._cat_primary_facet=_.values(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))[0].groupName,amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:self.model.get("idFilter"),value:!0,type:self.model.get("type"),groupName:self.model.get("groupName"),primary:window._cat_primary_facet===self.model.get("groupName")})},100);else if(0===params.indexOf("serialNumber:")){var facetParam=params.split(":");2===facetParam.length&&this.model.get("idFilter")==facetParam[0]&&(this.$el.parent().parent().parent().addClass("show").siblings(".facet-filter").addClass("open"),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:"serialNumber",type:"facet",groupName:"serialNumber",primary:!0,value:!0,serialNumber:facetParam[1]}),$("#serial-number-select").val(facetParam[1]))}else if(0===params.indexOf("hours:")||0===params.indexOf("year:")||0===params.indexOf("price:")){var facetParam=params.split(":");if(3===facetParam.length&&this.model.get("idFilter")==facetParam[0]){this.$el.parent().parent().parent().addClass("show").siblings(".facet-filter").addClass("open");var name=facetParam[0],min=facetParam[1]/1,max=facetParam[2]/1;amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:name,type:"facet",groupName:name+"rangeInput",primary:!0,value:!0,rangeInputMin:min,rangeInputMax:max})}}},onFilterReset:function(evt){this.$el.find("input").prop("checked",""),this.$el.slideDown(200),this.$el.removeClass("hidden"),this.$el.removeClass("selected")},onFilterClick:function(evt){if("year-range-select"!==evt.target.id&&"price-range-select"!==evt.target.id&&"hours-range-select"!==evt.target.id){if("serial-number-select"!=evt.target.id&&backToFirstPage(),"hours-range-input-min"===evt.target.id||"hours-range-input-max"===evt.target.id||"year-range-input-min"===evt.target.id||"year-range-input-max"===evt.target.id||"price-range-input-min"===evt.target.id||"price-range-input-max"===evt.target.id)return updateSliderWithRangeInput("year"),updateSliderWithRangeInput("hours"),void updateSliderWithRangeInput("price");evt.preventDefault(),this.$el.toggleClass("selected");var active=this.$el.hasClass("selected"),checkID=this.$el.find("input").attr("id");checkID.replace("filter-type","").replace("-"," ");if("label"===$(evt.currentTarget)[0].localName&&this.$el.find("input").prop("checked",active),$("html").hasClass("lt-ie9")){var $checkBox=this.$el.find("input");!0===active?$checkBox.attr("checked","checked"):$checkBox.removeAttr("checked")}_.isEmpty(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))&&(window._cat_primary_facet=this.model.get("groupName")),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:this.model.get("idFilter"),value:active,type:this.model.get("type"),groupName:this.model.get("groupName"),primary:window._cat_primary_facet===this.model.get("groupName")})}},updateLabel:function(label){var labelUS=this.model.get("name")[0],labelMETRIC=this.model.get("name")[1],count=this.model.get("count");"ar_SA"!==window._cat_locale?($(this.$el.find("label")[0]).html(labelMETRIC+" ("+count+")"),$(this.$el.find("label")[1]).html(labelUS+" ("+count+")")):($(this.$el.find("label")[0]).html("("+count+") "+labelMETRIC),$(this.$el.find("label")[1]).html("("+count+") "+labelUS))},addFamilyTypeSimpleCount:function(collection){var isRental="rental"===window._cat_prodtype,count=0,self=this,active=this.$el.hasClass("selected");collection.each(function(item){_.each(item.attributes.filters,function(filter){filter===self.model.get("idFilter")&&count++})}),this.model.set("count",count),this.updateLabel(),isRental?0!==count?(this.$el.slideDown(200),this.$el.removeClass("hidden")):active||(this.$el.slideUp(200),this.$el.addClass("hidden")):(this.$el.slideDown(200),this.$el.removeClass("hidden"))},validateFacetQuantity:function(collection,type,groupName){var count=0,id=this.model.get("idFilter"),active=this.$el.hasClass("selected");collection.each(function(item){_.each(item.attributes.filters,function(filter){id===filter&&count++},this)}),0!==count||active||(this.$el.slideUp(200),this.$el.addClass("hidden")),count>0&&(this.$el.slideDown(200),this.$el.removeClass("hidden"));var wrap=this.$el.parent().parent().parent().parent(),list=this.$el.parent();list.find(".hidden").length===list.children().length?wrap.hide():wrap.show(),this.model.set("count",count),this.updateLabel()}}),CATFacetedFilterRadioView=Backbone.View.extend({model:CATFacetedFilterModel,events:{click:"onFilterClick"},onFilterClick:function(evt){evt.preventDefault()}}),CATFacetedClear=Backbone.View.extend({events:{click:"onClear"},onClear:function(evt){evt.preventDefault(),backToFirstPage(),amplify.publish(CAT_EVENTS.CATALOG_FILTER_RESET),$("#serial-number-select").val("")}}),CATFacetedUrl=Backbone.View.extend({id:"faceted-url",initialize:function(){amplify.subscribe(CAT_EVENTS.FACETED_URL,this.onFacetedUrl)},events:{click:"generateUrl"},generateUrl:function(evt){evt.preventDefault(),CatNS.tpl.loadTemplates(["faceted-modal"],function(){var constructedUrl=window.location.pathname.replace("/content/finning","")+"?facetIds=",$selectedFacets=$(".facet-container li.filter.selected"),facetLength=$selectedFacets.length;$selectedFacets.each(function(index){constructedUrl+=index==facetLength-1?$(this).data("id"):$(this).data("id")+"|"});var localTemplate=_.template(CatNS.tpl.get("faceted-modal"));$("#faceted-modal-container").html(localTemplate({constructedUrl:constructedUrl})),$("#faceted-modal").modal("show")})},onFacetedUrl:function(){if(window.location.href.indexOf("?facetIds=")>0){var selectedFacetedElements=window.location.href.split("?facetIds=")[1];selectedFacetedElements&&$.each(selectedFacetedElements.split("|"),function(i,value){amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,value.replace(".html",""))})}}});head.ready(function(){$(function(){if($("#product-family-page").length){CatNS.CATEnhanceModel.initialize();var filtersCollection=(new CATFacetedClear({el:$("#family-clear-all")}),new CATFacetedFilterCollection);new CATFacetedFilterListView({model:filtersCollection}),new CATFacetedUrl({el:$("#faceted-url")})}$("#rental-nav-selector").length&&("rental"===window._cat_prodtype?$("#toggle-narrow-rental").prop("checked",!0):"checked"!=$("#toggle-narrow-used").attr("checked")&&$("#toggle-narrow-new").prop("checked",!0),$("#rental-nav-selector").find("input").on("click",function(e){console.log("E,",e),window.location=$(e.target).data("fwd")}),window.onunload=function(){})})}),head.ready(function(){$("#request-a-rentalquote-page").length>0&&($("select#jobsite-country").on("change",function(){$state=$("#jobsite-stateprov"),0===$("jobsite-stateprov").length&&$("#jobsite-stateprov").remove(),manageStateProvince(this.value,"jobsite-stateprov"),validateStateBox($("#jobsite-stateprov")),$(".stateprov-box .error-text").hide()}),$("#jobsite-stateprov[data-validate]").on("change blur",function(){validateStateBox($(this))}))});var CatNS=CatNS||{};head.ready(function(){var CATCartListView=Backbone.View.extend({initialize:function(){var that=this;amplify.subscribe("cat_delete_item",function(data){that.checkCartGroups(data)});var items=this.$el.find(".facet-cart-item,.facet-cart-new");_.each(items,function(item){var itemModel=new CATCartModel({itemtype:$(item).find("input[name='itemtype']").val(),pid:$(item).find("input[name='pid']").val(),path:$(item).find("input[name='path']").val()});new CATCartItemView({model:itemModel,el:item})})},checkCartGroups:function(data){var rentalGroup=this.$el.find(".cart-rental"),newGroup=this.$el.find(".cart-new");0===rentalGroup.find(".facet-cart-item").length&&rentalGroup.remove(),0===newGroup.find(".facet-cart-item").length&&newGroup.remove(),$("h2").text($("h2").text().split(":")[0]+": "+data.totalitems)}}),CATCartItemView=Backbone.View.extend({model:CATCartModel,initialize:function(){console.log("NEW CartItem view",this);var that=this;amplify.subscribe(CAT_EVENTS.CART_DELETE_SUCCESS,function(data){that.removeSuccess(data)}),amplify.subscribe(CAT_EVENTS.CART_UPDATE_SUCCESS,function(data){that.updateSuccess(data)});var today=new Date;this.$el.find(".input-append.date").datepicker({autoclose:!0,format:"mm/dd/yyyy",startDate:today})},events:{"change input[type='checkbox']":"updateDelivered","change select":"updateQty","click .cart-remove":"removeItem","changeDate .input-append.date.from":"updateStartDate","changeDate .input-append.date.to":"updateEndDate"},removeItem:function(evt){evt.preventDefault(),this.model.remove(this.removeSuccess)},removeSuccess:function(data){console.log("delete success",data),data.pid===this.model.get("pid")&&data.itemtype===this.model.get("itemtype")&&(this.remove(),amplify.publish("cat_delete_item",data))},updateQty:function(evt){var qty=evt.target.value;console.log("qty",qty),this.model.set("quantity",qty),this.model.update(this.updateSucess)},updateDelivered:function(evt){var delivered=evt.target.checked;this.model.set("delivered",delivered),this.model.update(this.updateSucess)},updateEndDate:function(evt){var endDate=this.$el.find(".to");console.log("set end date to",endDate.find("input").val()),this.model.set("endDate",endDate.find("input").val()),this.model.update(this.updateSucess)},updateStartDate:function(evt){var startDate=this.$el.find(".from");console.log("set start date to",startDate.find("input").val()),this.model.set("startDate",startDate.find("input").val());var sd=new Date(startDate.datepicker("getDate"));sd.setDate(sd.getDate()+1),this.$el.find(".to").datepicker("setStartDate",sd),this.model.update(this.updateSucess)},updateSuccess:function(data){data.pid===this.model.get("pid")&&console.log("updateSucess")}}),CATCartModel=Backbone.Model.extend({defaults:{itemtype:"new/rental",pid:"0",path:"0",name:"0"},initialize:function(){},fetch:function(params){amplify.request({resourceId:CAT_SERVICES_NAME.CART,data:{action:params.action,pid:params.pid,itemtype:params.itemtype,quantity:params.quantity,path:params.path,startDate:params.startDate,endDate:params.endDate,delivered:params.delivered},success:function(data){if(console.log("RESPONSE",data),"success"===data.result)switch(data.action){case"delete":amplify.publish(CAT_EVENTS.CART_DELETE_SUCCESS,data);break;case"update":amplify.publish(CAT_EVENTS.CART_UPDATE_SUCCESS,data)}else amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})},remove:function(callback){console.log("removing item"),this.fetch({action:"delete",pid:this.get("pid"),itemtype:this.get("itemtype"),callback:callback})},update:function(callback){console.log("updating item"),this.fetch({action:"update",pid:this.get("pid"),itemtype:this.get("itemtype"),quantity:this.get("quantity"),startDate:this.get("startDate"),endDate:this.get("endDate"),delivered:this.get("delivered"),path:this.get("path"),callback:callback})}});new CATCartListView({el:$(".cart-list")})});var getCurrentPage=function(number){var pageNumber={selectedNumber:number,familyID:amplify.store(CAT_STORE.CAT_FAMILY_ID)};localStorage.setItem("pageNumbers",JSON.stringify(pageNumber))};head.ready(function(){CatNS.tpl.loadTemplates(["cat-single-card","pagination","cat-sidekick"],function(){var CATCatalogRouter=Backbone.Router.extend({routes:{":id":"deeplink"},initialize:function(){window.location.hash&&window.location.hash.split("#")[1]&&this.deeplinkFilter(window.location.hash.split("#")[1])},deeplinkFilter:function(data){amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,data)}}),CATCatalogItemModel=Backbone.Model.extend({defaults:{idmodel:"1",model_name:"cat model name",image_url:"",small_image_url:"",family:"cat family: dozers,draglines etc",familyId:"id",itemtype:"new/rental",sort_order:"1",specs:[],compare_url:"",detail_url:"full path to detail",filters:[],dealers:[],priceList:[],keys:[]},initialize:function(){var family=this.get("familyId"),count=0;_.each(this.get("filters"),function(f){f===family&&count++}),0===count&&this.get("filters").push(family),this.set("keys",CatNS.i18n.keys),0===count&&""!==this.get("compare_url")&&this.set("compare_url",window._cat_effective_url+"/../"+this.get("compare_url"))}}),CATCatalogPageCollection=Backbone.PageableCollection.extend({model:CATCatalogItemModel,mode:"client"}),CATCatalogItemCollection=Backbone.Collection.extend({model:CATCatalogItemModel,fetch:function(params){var servicePath=window._cat_effective_url+CAT_SERVICES_URL.CATALOG_DATA+"?ts="+(new Date).getTime(),collection=this;amplify.request.define(CAT_SERVICES_NAME.CATALOG_DATA,"ajax",{url:servicePath,dataType:"json",type:"GET"}),amplify.request({resourceId:CAT_SERVICES_NAME.CATALOG_DATA,success:function(data){collection.reset(data.models),initializeSerialNumber(),initializeRangeInputFilter("hours"),initializeRangeInputFilter("year"),initializeRangeInputFilter("price"),amplify.publish(CAT_EVENTS.CATALOG_SUCCESS,collection,data.sidekicks,data.dealers),($("#hours-range-select").size()>0||$("#price-range-select").size()>0||$("#year-range-select").size()>0)&&initializeRangeSlider(collection.models),amplify.publish(CAT_EVENTS.FAMILY_PRICE_DROPDOWN,{hasPrice:data.hasPrice}),amplify.publish(CAT_EVENTS.CATALOG_FILTER_REFRESH)},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})}}),CATCatalogListView=Backbone.View.extend({el:$(".catalog-container"),model:CATCatalogPageCollection,sidekickCollection:"",initialize:function(){},render:function(sidekick){this.$el.empty();var row=$("<div class='row-fluid'></div>").appendTo(this.$el),last=this.model.getPage(this.model.state.currentPage).length-1;if(console.log("RENDER CATALOG",this.model),$("#rental-no-dealers-box")&&($("#rental-no-dealers-box").hide(),$(".catalog-top-pag").show(),$(".catalog-bottom-pag").show()),this.model.getPage(this.model.state.currentPage).each(function(detail,index){var item=new CATCatalogItemView({model:detail,index:index,last:index===last});if(index%3==0){if(3===index&&sidekick)if(this.model.length){var sidekickView=new CATSidekickView({model:sidekick});$(sidekickView.el).appendTo(this.$el),$("#rental-no-dealers-box").hide(),$(".catalog-top-pag").show(),$(".catalog-bottom-pag").show()}else $("#rental-no-dealers-box").show(),$(".catalog-top-pag").hide(),$(".catalog-bottom-pag").hide();row=$("<div class='row-fluid equal-height'></div>").appendTo(this.$el)}row.append(item.el)},this),this.model.getPage(this.model.state.currentPage).length<=3&&sidekick)if(this.model.length){var sidekickView=new CATSidekickView({model:sidekick});$(sidekickView.el).appendTo(this.$el),$("#rental-no-dealers-box").hide(),
$(".catalog-top-pag").show(),$(".catalog-bottom-pag").show()}else $("#rental-no-dealers-box").show(),$(".catalog-top-pag").hide(),$(".catalog-bottom-pag").hide();this.model.length||($("#rental-no-dealers-box").show(),$(".catalog-top-pag").hide(),$(".catalog-bottom-pag").hide())}}),sortArray=function(array){array.sort(function(a,b){return a-b})},updateRangeSlider=function(updateModels,updateName){var priceArray=[],hoursArray=[],yearArray=[];updateModels.forEach(function(model,index){model.attributes.specs.forEach(function(spec,index){if(spec.spec_name===Granite.I18n.get("price")&&updateName!==Granite.I18n.get("price")){var price=spec.spec_value[1].replace(/[^\d]*/g,"")/100;0!==price&&priceArray.push(price)}else spec.spec_name===Granite.I18n.get("hours")&&updateName!==Granite.I18n.get("hours")?hoursArray.push(spec.spec_value[0]/1):spec.spec_name===Granite.I18n.get("year")&&updateName!==Granite.I18n.get("year")&&yearArray.push(spec.spec_value[0]/1)})}),sortArray(priceArray),sortArray(hoursArray),sortArray(yearArray);var priceSlider=$("#price-range-select").data("ionRangeSlider"),hoursSlider=$("#hours-range-select").data("ionRangeSlider"),yearSlider=$("#year-range-select").data("ionRangeSlider");null!=priceSlider&&null!=hoursSlider&&null!=yearSlider&&("year"!==updateName&&(yearSlider.update({from:yearArray[0],to:yearArray[yearArray.length-1]}),rangeInputSetup("year",yearArray[0],yearArray[yearArray.length-1])),"hours"!==updateName&&(hoursSlider.update({from:hoursArray[0],to:hoursArray[hoursArray.length-1]}),rangeInputSetup("hours",hoursArray[0],hoursArray[hoursArray.length-1])),"price"!==updateName&&(priceArray.length>0?($("#price-range-select").parents(".row-fluid").eq(0).show(),priceSlider.update({from:priceArray[0],to:priceArray[priceArray.length-1]}),rangeInputSetup("price",priceArray[0],priceArray[priceArray.length-1])):$("#price-range-select").parents(".row-fluid").eq(0).hide()))},rangeInputSetup=function(filterName,min,max){$("#"+filterName+"-range-input-min").val(min),$("#"+filterName+"-range-input-max").val(max)},sliderSetUp=function(array,sliderName,prefixStr){var clearBtn=$("#"+sliderName+"-clear-all"),slider=$("#"+sliderName+"-range-select");$("#"+sliderName+"-range-input-min").val(array[0]),$("#"+sliderName+"-range-input-max").val(array[array.length-1]),slider.ionRangeSlider({type:"double",grid:!0,min:array[0],max:array[array.length-1],from:array[0],to:array[array.length-1],hide_min_max:!0,hide_from_to:!0,prefix:prefixStr,prettify_enabled:!1,onFinish:function(data){$("#"+sliderName+"-range-input-min").val(data.from),$("#"+sliderName+"-range-input-max").val(data.to)}}),clearBtn.on("click",function(event){event.preventDefault(),backToFirstPage();var slider=$("#"+sliderName+"-range-select").data("ionRangeSlider");slider.update({from:slider.options.min,to:slider.options.max}),$("#"+sliderName+"-range-input-min").val(slider.options.min),$("#"+sliderName+"-range-input-max").val(slider.options.max),clearBtn.hide(),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{name:sliderName,type:"clear",groupName:"slider"+sliderName,primary:!0,value:!0,to:0,from:0})})},hasSlider=function(){return void 0!=$("#hours-range-select").data("ionRangeSlider")||void 0!=$("#price-range-select").data("ionRangeSlider")||void 0!=$("#year-range-select").data("ionRangeSlider")},initializeRangeSlider=function(fullModels){Granite.I18n.setLocale($("meta[property='og:locale']").attr("content")),$("#hours-clear-all").hide(),$("#year-clear-all").hide(),$("#price-clear-all").hide();var prefixStr,priceArray=[],hoursArray=[],yearArray=[];fullModels.forEach(function(model,index){model.attributes.specs.forEach(function(spec,index){if(0===index){spec.spec_value[0].match(/[a-zA-Z]+/g)&&(prefixStr=spec.spec_value[0]+" ");var price=spec.spec_value[1].replace(/[^\d]*/g,"")/100;0!==price&&priceArray.push(price)}else 1===index?hoursArray.push(spec.spec_value[0]/1):2===index&&yearArray.push(spec.spec_value[0]/1)})}),sortArray(priceArray),sortArray(hoursArray),sortArray(yearArray),sliderSetUp(priceArray,"price",prefixStr),sliderSetUp(yearArray,"year",""),sliderSetUp(hoursArray,"hours","")},CATCatalogItemView=Backbone.View.extend({model:CATCatalogItemModel,className:"span4 selector single-card product-selector",template:_.template(CatNS.tpl.get("cat-single-card")),isLast:!1,initialize:function(params){var self=this;this.isLast=params.last,self.render(params.index),params.index%3==0&&this.$el.addClass("first-card"),""!==this.model.get("compare_url")&&-1===this.model.get("detail_url").indexOf("/finning-products/")||this.$el.find(".btn.compare").css("visibility","hidden"),this.$el.click(function(e){var viewState=JSON.parse(localStorage.getItem("viewState"));null!=viewState&&null!=viewState.onViewAll&&viewState.onViewAll&&(viewState.offsetTop=this.children[0].offsetTop,localStorage.setItem("viewState",JSON.stringify(viewState)))})},priceSelection:function(){if($familyCurrencyDropdown=$('.productCards select[name="currency"]'),void 0!=$familyCurrencyDropdown){var storedCurrency=amplify.store("storedCurrency");if(void 0!=storedCurrency)$(".product-card-price-"+storedCurrency).show();else{var currency=$familyCurrencyDropdown.find(":selected").text();$(".product-card-price-"+currency).show()}}},render:function(index){var delay=200*index,html=this.template(this.model.attributes),self=this;return this.$el.html(html).hide().delay(delay).fadeIn(200,function(){self.isLast&&amplify.publish(CAT_EVENTS.CATALOG_RENDER_DONE)}),self.priceSelection(),this}}),CATPaginationView=Backbone.View.extend({model:CATCatalogPageCollection,className:"pagination",template:_.template(CatNS.tpl.get("pagination")),gapSize:3,initialize:function(params){this.render()},render:function(index){var setup=[],viewState=JSON.parse(localStorage.getItem("viewState"));if(null!=viewState)viewState.familyID==amplify.store(CAT_STORE.CAT_FAMILY_ID)?(this.model.state.onViewAll=viewState.onViewAll,viewState.onViewAll&&(this.model.state.pageSize=this.model.state.totalRecords)):localStorage.removeItem("viewState");else{this.model.state.onViewAll=!1;var pageNumbers=JSON.parse(localStorage.getItem("pageNumbers"));null!=pageNumbers&&(pageNumbers.familyID==amplify.store(CAT_STORE.CAT_FAMILY_ID)?null!=pageNumbers.selectedNumber&&pageNumbers.selectedNumber<=this.model.state.totalPages&&(this.model.state.currentPage=pageNumbers.selectedNumber):localStorage.removeItem("pageNumbers"))}for(var renderData={model:this.model,setup:{},lastPage:!1,firstPage:!1,keys:CatNS.i18n.keys,viewAll:this.model.state.onViewAll},groups=Math.ceil(this.model.state.totalPages/this.gapSize),count=1,self=this,i=1;i<=groups;i++){var gap={};gap=count+this.gapSize-1<=this.model.state.totalPages?{start:count,end:count+this.gapSize-1}:{start:this.model.state.totalPages-this.gapSize,end:this.model.state.totalPages},this.model.state.currentPage>=gap.start&&this.model.state.currentPage<=gap.end&&(i===groups&&(renderData.lastPage=!0),1===i&&(renderData.firstPage=!0),renderData.setup=gap),setup.push(gap),count+=this.gapSize}var html=this.template(renderData);return this.$el.html(html),this.model.state.totalPages<=1&&!this.model.state.onViewAll?setTimeout(function(){self.$el.fadeOut(100)},0):setTimeout(function(){self.$el.fadeIn(100)},0),null!=viewState&&viewState.familyID==amplify.store(CAT_STORE.CAT_FAMILY_ID)&&viewState.onViewAll&&$(".catalog-top-pag").find("p.back-to-top").hide(),amplify.store(CAT_STORE.CAT_FAMILY_PAGE,this.model.state.currentPage),this},events:{"click .next":"nextPage","click .back":"previousPage","click .pag":"goToPage","click .viewAll":"viewAll","click .backToPages":"pagesView","click .backToTop":"backToTop"},show:function(){var self=this;this.model.state.totalPages<=1?setTimeout(function(){self.$el.fadeOut(100)},0):setTimeout(function(){self.$el.fadeIn(100)},0)},hide:function(){this.$el.hide()},nextPage:function(evt){evt.preventDefault(),this.model.state.currentPage!==this.model.state.totalPages&&(getCurrentPage(this.model.state.currentPage+1),amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state))},previousPage:function(evt){evt.preventDefault(),1!==this.model.state.currentPage&&(getCurrentPage(this.model.state.currentPage-1),amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state))},goToPage:function(evt){var pageNum;_.isNumber(evt)?pageNum=evt:(evt.preventDefault(),pageNum=Number($(evt.target).text())),pageNum!==this.model.state.currentPage&&(getCurrentPage(pageNum),this.model.getPage(pageNum),amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state))},viewAll:function(evt){evt.preventDefault(),$("html, body").animate({scrollTop:0},1e3),localStorage.removeItem("pageNumbers");var viewState={onViewAll:!0,familyID:amplify.store(CAT_STORE.CAT_FAMILY_ID)};localStorage.setItem("viewState",JSON.stringify(viewState)),this.model.state.pageSize=this.model.state.totalRecords,this.model.state.firstPage=1,this.model.state.lastPage=1,this.model.state.totalPages=1,this.model.state.currentPage=1,amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state)},pagesView:function(evt){evt.preventDefault(),$("html, body").animate({scrollTop:0},1e3),localStorage.removeItem("viewState"),this.model.state.firstPage=1,this.model.state.pageSize=Number($("#catalog-pagesize").val()),this.model.state.totalPages=Math.ceil(this.model.state.totalRecords/this.model.state.pageSize),this.model.state.lastPage=this.model.state.totalPages,this.model.state.currentPage=1,amplify.publish(CAT_EVENTS.CATALOG_PAGINATION,this.model.state)},backToTop:function(evt){evt.preventDefault(),$("html, body").animate({scrollTop:0},1e3)}}),CATSidekickModel=Backbone.Model.extend({defaults:{id:"0",title:"sidekick title",description:"description"}}),CATSidekickCollection=Backbone.Collection.extend({model:CATSidekickModel}),CATSidekickView=Backbone.View.extend({model:CATSidekickModel,className:"row-fluid catalog-sidekick",template:_.template(CatNS.tpl.get("cat-sidekick")),currentFamily:{},initialize:function(){this.render()},render:function(){var html=this.template(this.model);return this.$el.html(html),this}}),CATFilterResolverCollection=Backbone.Collection.extend(),CATCatalog={fullCollection:"",pagedCollection:"",filteredCollection:"",filteredDealerCollection:"",sidekickCollection:"",view:"",paginationTop:"",paginationBot:"",facetsCollection:"",facets:{},families:{},dealers:{},groups:{},currentGroup:"",currentCategory:"",familiesSelected:[],isRental:!1,init:function(pageSize,categoryId){var self=this;this.currentCategory=categoryId,this.facets={},this.dealers={},this.families={},this.facetsCollection=new CATFilterResolverCollection,this.groupCollection=new CATFilterResolverCollection,this.fullCollection=new CATCatalogItemCollection,this.filteredDealerCollection=new CATCatalogItemCollection,this.filteredCollection=new CATCatalogItemCollection,this.pagedCollection=new CATCatalogPageCollection([],{state:{pageSize:pageSize}}),this.fullCollection.fetch(),amplify.subscribe(CAT_EVENTS.CATALOG_SUCCESS,self,self.onData),amplify.subscribe(CAT_EVENTS.CATALOG_PAGINATION,self,self.render),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER,self,self.onFilter),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_RESET,this,self.onFilterReset),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_REFRESH,self,self.onFilterRefresh),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET,this,self.onFilterDealerReset),amplify.subscribe(CAT_EVENTS.CATALOG_RENDER_DONE,this,self.onRenderDone),amplify.subscribe(CAT_EVENTS.DEALERS_NEW_SEARCH,this,self.onNewLocation),amplify.subscribe(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL,self,self.noRentalDealers),amplify.subscribe(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL,self,self.rentalDealersAvalaible),amplify.subscribe(CAT_EVENTS.DEALERS_SEARCHING,self,function(){this.paginationTop&&(this.paginationTop.hide(),this.paginationBot.hide())}),amplify.subscribe(CAT_EVENTS.FAMILY_PRICE_DROPDOWN,function(data){0==data.hasPrice&&($(".productCards div.currency-converter").hide(),$("div.family-msrp-disclaimer").hide())}),this.isRental="rental"===window._cat_prodtype},noRentalDealers:function(){var currentSearch=amplify.store(CAT_STORE.DEALERS_SEARCHED);amplify.publish(CAT_EVENTS.HIDE_DEALER_LIST),this.isRental&&!_.isEmpty(currentSearch)&&($("#rental-no-dealers-box").fadeIn(),$(".catalog-top-pag").fadeOut(),$(".catalog-bottom-pag").fadeOut(),this.filteredCollection.reset([]),this.render())},rentalDealersAvalaible:function(){$("#rental-no-dealers-box").fadeOut(),$(".catalog-top-pag").length&&($(".catalog-top-pag").fadeIn(),$(".catalog-bottom-pag").fadeIn()),amplify.publish(CAT_EVENTS.SHOW_DEALER_LIST)},onRenderDone:function(){this.view.$el.find(".equal-height").each(function(){$(this).find(".height-item").matchHeight(!0)});var viewState=JSON.parse(localStorage.getItem("viewState"));null!=viewState&&viewState.familyID==amplify.store(CAT_STORE.CAT_FAMILY_ID)&&viewState.onViewAll&&null!=viewState.offsetTop&&($("html, body").animate({scrollTop:viewState.offsetTop},1e3),delete viewState.offsetTop,localStorage.setItem("viewState",JSON.stringify(viewState)))},onFilterDealerReset:function(){this.dealers={}},onFilterReset:function(){var currentDealerFullList=amplify.store(CAT_STORE.DEALERS),noLocation=_.isEmpty(currentDealerFullList);if(this.families={},this.facets={},this.isRental?noLocation?this.pagedCollection.fullCollection.reset(this.fullCollection.toJSON()):this.pagedCollection.fullCollection.reset(this.filteredDealerCollection.toJSON()):this.pagedCollection.fullCollection.reset(this.fullCollection.toJSON()),hasSlider()){var priceSlider=$("#price-range-select").data("ionRangeSlider"),hoursSlider=$("#hours-range-select").data("ionRangeSlider"),yearSlider=$("#year-range-select").data("ionRangeSlider");yearSlider.update({from:yearSlider.options.min,to:yearSlider.options.max}),hoursSlider.update({from:hoursSlider.options.min,to:hoursSlider.options.max}),priceSlider.update({from:priceSlider.options.min,to:priceSlider.options.max}),$("#price-clear-all").hide(),$("#hours-clear-all").hide(),$("#year-clear-all").hide()}this.render(),this.notifyFacets(),this.storeFacets()},onNewLocation:function(){this.pagedCollection.fullCollection.reset(this.fullCollection.toJSON())},onData:function(collection,sidekicks,dealers){var self=this,isNewCategory=!1,storedFamilyName="";if(this.sidekickCollection=new CATSidekickCollection(sidekicks),this.pagedCollection.fullCollection.reset(collection.toJSON()),amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE),amplify.store(CAT_STORE.CAT_CATALOG_DEALERS,dealers),_.isEmpty(amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE)))amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE,window._cat_prodtype);else{amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE)!==window._cat_prodtype&&(amplify.store(CAT_STORE.CAT_CURRENT_PAGETYPE,window._cat_prodtype),self.onFilterReset())}_.isEmpty(amplify.store(CAT_STORE.CAT_FAMILY_ID))||(storedFamilyName=amplify.store(CAT_STORE.CAT_FAMILY_ID))!==this.currentCategory&&(isNewCategory=!0),window.location.href.indexOf("?facetIds=")>0?amplify.publish(CAT_EVENTS.FACETED_URL):_.isEmpty(amplify.store(CAT_STORE.CAT_CATALOG_FACETS))?this.storeFacets():_.isEmpty(amplify.store(CAT_STORE.CAT_FAMILY_ID))?this.storeFacets():(storedFamilyName=amplify.store(CAT_STORE.CAT_FAMILY_ID),storedFamilyName!==this.currentCategory?(this.facets={},this.storeFacets()):_.each(amplify.store(CAT_STORE.CAT_CATALOG_FACETS),function(filter){"hours"===filter.name||"year"===filter.name||"price"===filter.name?amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,filter.name+":"+filter.rangeInputMin+":"+filter.rangeInputMax):"serialNumber"===filter.name?amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,filter.name+":"+filter.serialNumber):amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEEPLINK,filter.name)})),_.isEmpty(amplify.store(CAT_STORE.DEALERS))||amplify.publish(CAT_EVENTS.CATALOG_FILTER,null),setTimeout(function(){var initPage;isNewCategory||_.isEmpty(amplify.store(CAT_STORE.CAT_FAMILY_ID))?initPage=1:(storedFamilyName=amplify.store(CAT_STORE.CAT_FAMILY_ID),storedFamilyName===self.currentCategory&&_.isNumber(amplify.store(CAT_STORE.CAT_FAMILY_PAGE))?(initPage=amplify.store(CAT_STORE.CAT_FAMILY_PAGE))>self.pagedCollection.state.totalPages&&(initPage=1):initPage=1),self.view=new CATCatalogListView({model:self.pagedCollection.getPage(initPage),sidekickCollection:self.sidekickCollection}),self.paginationTop=new CATPaginationView({model:self.pagedCollection}),self.paginationBot=new CATPaginationView({model:self.pagedCollection}),$(".catalog-top-pag").html(self.paginationTop.el),$(".catalog-bottom-pag").html(self.paginationBot.el);var currentDealerFullList=_.isEmpty(amplify.store(CAT_STORE.DEALERS))?[]:amplify.store(CAT_STORE.DEALERS),searchTerm=amplify.store(CAT_STORE.DEALERS_SEARCHED);self.isRental&&searchTerm&&searchTerm.length>0&&0===currentDealerFullList.length?(console.log("NO ITEMS AT ALL ASSOCIATED TO THE DEALERS LIST"),amplify.publish(CAT_EVENTS.HIDE_DEALER_LIST),self.pagedCollection.fullCollection.reset([]),self.noRentalDealers(),self.notifyFacets()):(amplify.publish(CAT_EVENTS.SHOW_DEALER_LIST),self.view.render(self.sidekickCollection.where({id:self.checkFamilyFilters().name})[0])),amplify.subscribe(CAT_EVENTS.CAT_SPINNER_SHOW,self,function(){self.paginationTop&&(self.paginationTop.hide(),self.paginationBot.hide()),self.view.$el.hide()}),amplify.subscribe(CAT_EVENTS.CAT_SPINNER_HIDE,self,function(){self.view.$el.fadeIn(),self.paginationTop&&(self.paginationTop.show(),self.paginationBot.show())}),amplify.publish(CAT_EVENTS.CATALOG_FILTER,null)},1e3)},render:function(state){this.paginationTop&&(this.paginationBot.render(),this.paginationTop.render()),this.view&&this.view.render(this.sidekickCollection.where({id:this.checkFamilyFilters().name})[0])},onFilterRefresh:function(){updateRangeSlider(this.filteredCollection.models,"")},onFilter:function(filter){var self=this;filter&&("dealer"==filter.type&&this.setDealer(filter),"facet"==filter.type&&this.setFilter(filter),"slider"===filter.type&&this.setFilter(filter),"clear"===filter.type&&this.setFilter(filter),"family"==filter.type&&this.setFilter(filter),this.currentGroup=filter.groupName);var group_collection=[],facets_collection=[],dealers_collection=[];self.facetsCollection.reset([]);var currentDealerFullList=amplify.store(CAT_STORE.DEALERS),currentDealerSelectedList=amplify.store(CAT_STORE.DEALER_SELECTED),dealers_selected_ids=null,noLocation=_.isEmpty(currentDealerFullList);if(self.isRental)if(_.isEmpty(currentDealerFullList)){var searchTerm=amplify.store(CAT_STORE.DEALERS_SEARCHED);if(searchTerm&&searchTerm.length>0)return console.log("NO DEALERS AT ALL ASSOCIATED TO THE DEALERS LIST"),this.pagedCollection.fullCollection.reset([]),this.noRentalDealers(),this.notifyFacets(),!1;this.filteredDealerCollection=this.fullCollection.clone()}else{if(_.isEmpty(amplify.store(CAT_STORE.DEALER_SELECTED))?(console.log("NOT DEALER SELECTED LIST AVAILABLE",currentDealerSelectedList),dealers_selected_ids=_.keys(_.indexBy(currentDealerFullList,"encryptedDealerCode"))):(console.log("DEALER SELECTED LIST AVAILABLE",currentDealerSelectedList),dealers_selected_ids=_.keys(_.indexBy(currentDealerSelectedList,"encryptedDealerCode"))),_.each(this.fullCollection.models,function(item){_.each(item.get("dealers"),function(dealerId){_.contains(dealers_selected_ids,dealerId)&&!_.contains(dealers_collection,item)&&dealers_collection.push(item)})}),this.filteredDealerCollection.reset(dealers_collection),0===this.filteredDealerCollection.size())return console.log("NO ITEMS AT ALL ASSOCIATED TO THE DEALERS LIST"),this.pagedCollection.fullCollection.reset([]),this.noRentalDealers(),this.notifyFacets(),!1;0===this.filteredCollection.size()&&(this.filteredCollection=this.fullCollection.clone());var intersection=_.intersection(this.filteredDealerCollection.models,this.fullCollection.models);this.filteredCollection.reset(intersection)}else this.filteredDealerCollection=this.fullCollection.clone();_.each(this.facets,function(facet){facets_collection.push(facet.name),self.facetsCollection.add(facet)}),_.each(self.facetsCollection.groupBy("groupName"),function(group){group_collection.push(group)});var groupLength=group_collection.length;self.groupCollection.reset(group_collection);var familyFilteredCollection=null;if(null===filter&&(filter={}),familyFilteredCollection=this.isRental?noLocation?0===this.filteredCollection.size()||!filter.value||filter.primary?this.fullCollection.clone():this.filteredCollection.clone():0===this.filteredCollection.size()?this.filteredDealerCollection.clone():this.filteredCollection.clone():0===this.filteredCollection.size()||!filter.value||filter.primary?this.fullCollection.clone():this.filteredCollection.clone(),facets_collection.length){this.filteredCollection.reset();var outerValue=this;familyFilteredCollection.each(function(item,index){var count=0;item.get("filters");_.each(outerValue.facetsCollection.models,function(facet,index){item.attributes.specs.forEach(function(spec,index){if(spec.spec_name===Granite.I18n.get(facet.attributes.name))if(spec.spec_name===Granite.I18n.get("price")){var value=spec.spec_value[1].replace(/[^\d]*/g,"")/100;value<=facet.attributes.rangeInputMax&&value>=facet.attributes.rangeInputMin&&count++}else spec.spec_name===Granite.I18n.get("serialNumber")?spec.spec_value[0]===facet.attributes.serialNumber&&count++:spec.spec_value[0]<=facet.attributes.rangeInputMax&&spec.spec_value[0]>=facet.attributes.rangeInputMin&&count++})}),_.each(item.get("filters"),function(filter,index){_.each(group_collection,function(group){for(var i=group.length;i--;)if(group[i].attributes.name===filter){count++;break}})}),count>=groupLength&&self.filteredCollection.add(item)})}else this.filteredCollection=familyFilteredCollection.clone();null!==filter&&void 0!==filter.name&&hasSlider()&&updateRangeSlider(this.filteredCollection.models,filter.name),this.storeFacets(),this.pagedCollection.fullCollection.reset(this.filteredCollection.toJSON()),this.render(),this.notifyFacets(),"20px"==$(".catalog-sidekick").css("margin-top")&&($(".product-sidekick-wrapper a").removeClass("open"),$("#toggle-sidekick").removeClass("show"))},checkFamilyFilters:function(){var f=[];return!_.isEmpty(this.facets)&&(_.each(this.facets,function(facet){"family"==facet.type&&f.push(facet)}),_.each(this.facets,function(facet){"facet"==facet.type&&(f=[])}),1===f.length&&f[0])},storeFacets:function(){_.isEmpty(this.facets)?($("#family-clear-all").slideUp(200),updateRangeSlider(this.fullCollection.models,""),$("#price-range-select").parents(".row-fluid").eq(0).show(),$("#serialNumber-clear-all").hide()):($("#family-clear-all").slideDown(200),$.each(this.facets,function(index,value){"price"!==index&&"year"!==index&&"hours"!==index&&"serialNumber"!==index||$("#"+index+"-clear-all").length>0&&$("#"+index+"-clear-all").show()})),amplify.store(CAT_STORE.CAT_CATALOG_FACETS,this.facets),amplify.store(CAT_STORE.CAT_CATALOG_DEALERS_FACETS,this.dealers),amplify.store(CAT_STORE.CAT_FAMILY_ID,null),amplify.store(CAT_STORE.CAT_FAMILY_ID,this.currentCategory)},notifyFacets:function(){var currentDealerFullList=amplify.store(CAT_STORE.DEALERS),noLocation=_.isEmpty(currentDealerFullList);this.isRental?noLocation?amplify.publish(CAT_EVENTS.CATALOG_FILTER_UPDATE,this.pagedCollection.fullCollection,this.fullCollection,this.currentGroup,this.dealers):amplify.publish(CAT_EVENTS.CATALOG_FILTER_UPDATE,this.pagedCollection.fullCollection,this.filteredDealerCollection,this.currentGroup,this.dealers):amplify.publish(CAT_EVENTS.CATALOG_FILTER_UPDATE,this.pagedCollection.fullCollection,this.fullCollection,this.currentGroup,this.dealers)},setFilter:function(filter){this.facets[filter.name]?filter.value?"clear"===filter.type?delete this.facets[filter.name]:"price"!==filter.name&&"year"!==filter.name&&"hours"!==filter.name&&"serialNumber"!==filter.name||(this.facets[filter.name]=filter):(this.facets[filter.name]=null,delete this.facets[filter.name]):this.facets[filter.name]=filter},setDealer:function(dealer){this.dealers[dealer.name]?dealer.value||(this.dealers[dealer.name]=null,delete this.dealers[dealer.name]):this.dealers[dealer.name]=dealer},setFamily:function(family){this.families[family.name]?family.value||(this.families[family.name]=null,delete this.families[family.name]):this.families[family.name]=family}};$(function(){if($("#product-family-page").length&&CatNS.i18n.loadKeys(function(){amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);var CATFamilyId=$("#catalog-family-id").val(),CATPageSize=Number($("#catalog-pagesize").val());new CATCatalogRouter;CATCatalog.init(CATPageSize,CATFamilyId)}),$(".contact-rental")){$(".contact-rental").data("tel")&&$("html").hasClass("mobile")&&$(".contact-rental").on("click",function(e){window.location.href=$(this).data("tel")})}})})});var CatNS=CatNS||{};CatNS.compareCompetitor={Views:{},collections:{},cols:0,colMapping:[],compCnt:0,loadError:!1,competitorsInfo:{}},CatNS.lang="en",head.ready(function(){void 0!==__cq_var.compareCompetitor&&void 0!==__cq_var.compareCompetitor.info&&CatNS.tpl.loadTemplates(["cc-dropdown","cc-tab-content-template","cc-theader-template","cc-link-list-img-template","cc-table-data"],function(){CatNS.compareCompetitor.Views.dropdown=Backbone.View.extend({el:$(".dropdown .dropdown-menu"),template:_.template(CatNS.tpl.get("cc-dropdown")),initialize:function(){this.render()},render:function(){return $(".dropdown .dropdown-menu").append(this.template({competitors:this.collection})),CatNS&&CatNS.compare&&CatNS.compare.dropdown(),this}}),CatNS.compareCompetitor.Views.tabContent=Backbone.View.extend({el:$(".model-tab-contents .row-fluid"),template:_.template(CatNS.tpl.get("cc-tab-content-template")),initialize:function(){this.render()},render:function(){if(this.$el.append(this.template({competitors:this.model.get("Data"),compCnt:CatNS.compareCompetitor.compCnt,maxCols:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping})),CatNS.compareCompetitor.compCnt>0){new CatNS.compareCompetitor.Views.dropdown({collection:CatNS.compareCompetitor.collections.dropdown})}return this}}),CatNS.compareCompetitor.Views.tableHeader=Backbone.View.extend({el:$("#compare-table-header .no-hover"),template:_.template(CatNS.tpl.get("cc-theader-template")),initialize:function(){this.render()},render:function(){return this.$el.append(this.template({competitors:this.model.get("Data"),colCnt:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping})),this}}),CatNS.compareCompetitor.Views.linkList=Backbone.View.extend({el:$(".compare-model-listing .row-fluid"),template:_.template(CatNS.tpl.get("cc-link-list-img-template")),initialize:function(){this.render()},render:function(){return this.$el.append(this.template({competitors:this.model.get("Data"),compImg:CatNS.compareCompetitor.competitorsInfo.competiorImage,maxCols:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping})),amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE,".compare-model-tabs"),$.fn.matchHeight._update(),this}}),CatNS.compareCompetitor.Views.tableData=Backbone.View.extend({el:$(".compare-data-accordion .three-col tbody"),template:_.template(CatNS.tpl.get("cc-table-data")),initialize:function(){this.render()},render:function(){var self=this;console.log("render: ",this.collection);for(var len=this.collection.length,i=0;i<len;i++){var dataModel=self.collection[i];self.$el.append(self.template({model:dataModel,colCnt:CatNS.compareCompetitor.cols,colMapping:CatNS.compareCompetitor.colMapping}))}return this}}),CatNS.compareCompetitor.init=function(){if(CatNS.compareCompetitor.cols=0,__cq_var.compareCompetitor&&__cq_var.compareCompetitor.info){__cq_var.lang&&""!==__cq_var.lang&&(CatNS.lang=__cq_var.lang),amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW),CatNS.compareCompetitor.competitorsInfo=__cq_var.compareCompetitor.info,console.log("compareCompetitor init id:",CatNS.compareCompetitor.competitorsInfo.models[0]);var modelId=CatNS.compareCompetitor.competitorsInfo.models[0],regionIds=__cq_var.compareCompetitor.info.rgids;modelId.indexOf(",")>-1&&(console.log("split the string"),CatNS.compareCompetitor.competitorsInfo.models=modelId.split(","),$("#model-tab-content-0 h5").attr("data-model-id",CatNS.compareCompetitor.competitorsInfo.models[0])),console.log("new array:",CatNS.compareCompetitor.competitorsInfo.models);(new CATCompetitorCollection).fetch({id:CatNS.compareCompetitor.competitorsInfo.models[0],lid:CatNS.lang,rgids:regionIds},CatNS.compareCompetitor.competitorsInfo.catSpecCheckId),amplify.subscribe(CAT_EVENTS.COMPETITORS_SUCCESS,CatNS.compareCompetitor.handleCompetitorCollection),amplify.subscribe(CAT_EVENTS.SERVICE_ERROR,CatNS.compareCompetitor.handleAjaxError)}},CatNS.compareCompetitor.handleAjaxError=function(status){if(console.log("3. ------ handleAjaxError: ",status),!CatNS.compareCompetitor.loadError){CatNS.compareCompetitor.loadError=!0;var errorDiv=".spinner-error";"timeout"===status&&(errorDiv=".spinner-timeout"),amplify.publish(CAT_EVENTS.CAT_SPINNER_ERROR,errorDiv)}},CatNS.compareCompetitor.handleCompetitorCollection=function(collection){if(console.log("handleCompetitorCollection collection.length=",collection.length,collection),!window._cat_ajax_timedout){if(collection.length<1)return void CatNS.compareCompetitor.handleAjaxError("server-error");if(1===CatNS.compareCompetitor.competitorsInfo.models.length){var top2Models=collection.getTop2Models();$.each(top2Models,function(index,comp){CatNS.compareCompetitor.competitorsInfo.models.push(comp.get("Machine_ID"))})}else{console.log("more than 1 ids");collection.removeSelectedModels(CatNS.compareCompetitor.competitorsInfo.models.slice(1))}CatNS.compareCompetitor.compCnt=collection.length,CatNS.compareCompetitor.collections.dropdown=collection.getGroups(),CatNS.compareCompetitor.cols=CatNS.compareCompetitor.competitorsInfo.models.length,CatNS.compareCompetitor.cols>3&&(CatNS.compareCompetitor.cols=3);var dataIds=CatNS.compareCompetitor.competitorsInfo.models.join(",");console.log("dataId=",dataIds);(new CATCompetitorDataCollection).fetch({ids:dataIds,lid:CatNS.lang,rgids:__cq_var.compareCompetitor.info.rgids}),amplify.subscribe(CAT_EVENTS.COMPETITORS_DATA_SUCCESS,CatNS.compareCompetitor.handleDataCollection)}},CatNS.compareCompetitor.handleDataCollection=function(collection){if(!window._cat_ajax_timedout){CatNS.compareCompetitor.collections.compDataHeader=collection.getHeader(),CatNS.compareCompetitor.collections.compDataTable=collection.getData();var i,k,len=CatNS.compareCompetitor.competitorsInfo.models.length,headerData=CatNS.compareCompetitor.collections.compDataHeader.get("Data"),dataLen=headerData.length;for(i=0;i<len;i++){var id=CatNS.compareCompetitor.competitorsInfo.models[i];for(k=0;k<dataLen;k++)if(id==headerData[k].Machine_ID){CatNS.compareCompetitor.colMapping.push(k);break}}console.log("dataMapping:",CatNS.compareCompetitor.colMapping);var $tabs=$(".compare-model-tabs .model-tab"),tabLen=$tabs.length;CatNS.compareCompetitor.cols;for(i=0;i<CatNS.compareCompetitor.cols;i++)i<tabLen&&$($tabs.get(i)).removeClass("hidden");new CatNS.compareCompetitor.Views.tabContent({model:CatNS.compareCompetitor.collections.compDataHeader}),new CatNS.compareCompetitor.Views.tableHeader({model:CatNS.compareCompetitor.collections.compDataHeader}),new CatNS.compareCompetitor.Views.tableData({collection:CatNS.compareCompetitor.collections.compDataTable}),new CatNS.compareCompetitor.Views.linkList({model:CatNS.compareCompetitor.collections.compDataHeader})}},CatNS.compareCompetitor.init()})});var CatNS=CatNS||{};head.ready(function(){CatNS.tpl.loadTemplates(["dealer-list","dealer-modal","dealer-modal-detail"],function(){CatNS.DealerListView=Backbone.View.extend({el:$(".dealer-list-container"),template:_.template(CatNS.tpl.get("dealer-list")),initialize:function(){var self=this,collection=this.model.toJSON(),current_ids=[];_.each(collection,function(item){current_ids.push(item.encryptedDealerCode)}),self.render(),amplify.subscribe(CAT_EVENTS.HIDE_DEALER_LIST,function(){self.$el.find(".filter").hide()}),
amplify.subscribe(CAT_EVENTS.SHOW_DEALER_LIST,function(){self.$el.find(".filter").show()}),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_UPDATE,function(filteredCollection,fullCollection,groupName,dealersSelected){var idCollection=[];filteredCollection.each(function(item){idCollection=_.union(idCollection,item.get("dealers"))});var inactives=_.difference(current_ids,idCollection);_.difference(current_ids,inactives)}),amplify.subscribe(CAT_EVENTS.DEALERS_NOT_AVAILABLE_RENTAL,self,function(){self.showError(!0)}),amplify.subscribe(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL,self,function(){self.showError(!1)})},render:function(){$(".dealer-list-container").hasClass("hidden")||amplify.publish("empty-list"),this.$el.find("form fieldset ul.filters").html(this.template({dealers:this.model.toJSON()})),amplify.publish("toggle-list"),amplify.publish("toggle-loader"),(this.model.length||""!==amplify.store("DEALERS_SEARCHED"))&&$(".facet-dealer-clear").show()},showError:function(value){value?(this.$el.find(".no-dealers-box").fadeIn(),this.$el.find(".filter").hide()):(this.$el.find(".no-dealers-box").hide(),this.$el.find(".filter").show())}}),CatNS.DealerFormView=Backbone.View.extend({el:$(".facet-dealer"),events:{"submit #get-dealer-location":"submitForm","keyup .clearToggle":"showClear","click .facet-dealer-clear":"clearAction","click .filter input[type='radio']":"trackDealer","click .filter input[type='checkbox']":"toggleSelect","click .details":"openModal"},initialize:function(){var that=this;if(amplify.subscribe(CAT_EVENTS.GOOGLE_GEO_ERROR,function(){$("#zip-code").addClass("error"),that.$el.find(".error-text").show()}),amplify.subscribe("toggle-list",function(){that.toggleList()}),amplify.subscribe("toggle-loader",function(){that.toggleLoader()}),amplify.subscribe("empty-list",function(){that.emptyList()}),amplify.store(CAT_STORE.CAT_FAMILY_ID)!==$("#catalog-family-id").val())amplify.store(CAT_STORE.DEALERS_SEARCHED)&&($("#zip-code").val(amplify.store(CAT_STORE.DEALERS_SEARCHED)),this.submitForm());else if(amplify.store(CAT_STORE.DEALERS_SEARCHED)&&($(".facet-dealer-clear").css("display","inline"),$("#zip-code").val(amplify.store(CAT_STORE.DEALERS_SEARCHED))),amplify.store(CAT_STORE.DEALERS)&&(amplify.publish("toggle-loader"),CatNS.CATEnhanceModel.dealers.reset(amplify.store(CAT_STORE.DEALERS)),new CatNS.DealerListView({model:CatNS.CATEnhanceModel.dealers})),!_.isEmpty(amplify.store(CAT_STORE.DEALER_SELECTED))){var dealersToMark=amplify.store(CAT_STORE.DEALER_SELECTED);_.each(dealersToMark,function(dealer){$("#dealer-"+dealer.intId).prop("checked",!0),$("#li-"+dealer.intId).addClass("selected")})}},emptyList:function(){this.toggleList(),$(".facet-dealer").find(".dealer-list-container").find("ul.filters li:not(.all)").remove()},toggleLoader:function(){this.$el.find(".loading").toggleClass("hidden")},toggleList:function(){this.$el.find(".dealer-list-container").toggleClass("hidden")},toggleSelect:function(event){var dealerId=event.target.id.split("-")[1],dealerDom=$("#dealer-"+dealerId);$("#li-"+dealerId).toggleClass("selected");var isSelected=$("#li-"+dealerId).hasClass("selected"),data={value:!0,dealer:_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:dealerDom.data("parent")})};isSelected?(data.value=!0,amplify.publish(CAT_EVENTS.DEALER_SELECTED,data),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{type:"dealer",name:dealerDom.data("parent"),value:!0})):(data.value=!1,amplify.publish(CAT_EVENTS.DEALER_SELECTED,data),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{type:"dealer",name:dealerDom.data("parent"),value:!1}))},trackDealer:function(event){},submitForm:function(event){event&&event.preventDefault(),amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW),$("#zip-code").removeClass("error"),this.$el.find(".error-text").hide();var address=this.$el.find("#zip-code").val();""!==address||void 0!==address?(amplify.publish("toggle-loader"),this.$el.find(".dealer-list-container").hasClass("hidden")||this.emptyList(),amplify.store(CAT_STORE.DEALERS,null),amplify.store(CAT_STORE.DEALER_SELECTED,null),amplify.store(CAT_STORE.DEALERS_SEARCHED,null),amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null),amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET),setTimeout(function(){amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL),CatNS.CATEnhanceModel.getDealerLocation(address,!0)},500)):alert("please enter search query")},showClear:function(){$(".facet-dealer-clear").css("display","inline")},clearAction:function(){$("input.clearToggle").val(""),$(this).css("display","none"),$(".facet-dealer-clear").hide(),$("dealer-list-container").hasClass("hidden")||this.emptyList(),amplify.store(CAT_STORE.DEALERS,null),amplify.store(CAT_STORE.DEALER_SELECTED,null),amplify.store(CAT_STORE.DEALERS_SEARCHED,null),amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null),amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{value:!1}),amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL)},updateDealerList:function(){},openModal:function(e){e.preventDefault();var dealerId=$(e.target).data("dealer-id");CatNS.DealerModal&&(CatNS.DealerModal=null,delete CatNS.DealerModal),CatNS.DealerModal=new CatNS.DealerModalDetail({id:dealerId})}}),CatNS.DealerModalCollection=Backbone.Collection.extend({fetch:function(params){console.log("DEALER MODAL Collection fetch",params);var useOriginalDealerList=!1,pathArray=window.location.href.split("/"),protocol=pathArray[0],host=pathArray[2],url=protocol+"//"+host,product="";params?(void 0!=params.productPath&&void 0!=params.useOriginalDealerList&&(useOriginalDealerList=!params.productPath||params.useOriginalDealerList),product=params.productPath?params.productPath:window._cat_prodpath):product=window._cat_prodpath;var data='["'+product+'"]',servicePath=url+CAT_SERVICES_URL.DEALERS_BY_PRODUCT+data,collection=this;console.log("calling dealerview",servicePath),amplify.request.define(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,"ajax",{url:servicePath,dataType:"json",type:"GET"}),amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,success:function(data){console.log(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,data);var dealers=amplify.store(CAT_STORE.DEALERS),dealersRaw=amplify.store(CAT_STORE.DEALERS_RAW),ids=data.dealers,dealersFiltered=[];_.each(ids,function(id){var dealerFound=_.findWhere(dealers,{encryptedDealerCode:id});dealerFound&&dealersFiltered.push(dealerFound)}),useOriginalDealerList?(collection.reset(dealersRaw),collection.isRaw=!0):collection.reset(dealersFiltered),amplify.publish(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,collection)},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})}}),CatNS.DealerModalView=Backbone.View.extend({collection:new CatNS.DealerModalCollection,template:_.template(CatNS.tpl.get("dealer-modal")),initialize:function(params){var self=this;console.log("DEALER MODAL View PRAMS",params),amplify.subscribe(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,function(collection){return collection&&collection.length>0&&(collection=collection.sortBy(function(dealer){return dealer.get("distanceInMilesClosestBranch")}),self.collection.reset(collection)),self.render(),amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE),!1}),amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW),this.collection.fetch(params)},render:function(){var self=this;$("body").append(this.template({dealers:self.collection.toJSON()})),$.each($(".dealer-modal-locations"),function(){var $self=$(this),charLimit=0,locationStr=$self.text();locationStr=locationStr.replace(/(\r\n|\n|\r)/gm,"").replace(/\s{2,}/g," "),charLimit=$(".lt-480").length>0?44:$(".lt-640").length>0?52:$(".gt-768").length>0?55:60,locationStr.length>=charLimit&&$self.text(locationStr.slice(0,charLimit)+"...")}),$("#dealer-modal").modal("show"),$("#dealer-modal").on("hidden.bs.modal",function(){self.remove(),$("#dealer-modal").remove()}),$(".modal-backdrop").on("click",function(){$("#dealer-modal").modal("hide")}),$("#select-dealer-button").on("click",function(){self.changeDealer()});var selectDealerButton=$("#select-dealer-button");selectDealerButton.prop("disabled",!0),selectDealerButton.addClass("disabled"),$("body").on("click",".dealer>input[name*='dealer-modal-radio']",function(){selectDealerButton.prop("disabled",!1),selectDealerButton.removeClass("disabled")})},changeDealer:function(){var value=$("input:radio[name ='dealer-modal-radio']:checked").data("code");if(window.console&&console.log("DEALER SELECTED",value),value){var dealerData=_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:value});_.isEmpty(dealerData)&&(dealerData=_.findWhere(amplify.store(CAT_STORE.DEALERS_RAW),{encryptedDealerCode:value}));var data={dealer:dealerData,value:!0};console.log("IS RAW",this.collection.isRaw),this.collection.isRaw||amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,data.dealer),amplify.publish(CAT_EVENTS.DEALER_SELECTED,data,this.collection.isRaw)}$("#dealer-modal").modal("hide")}}),CatNS.moveToPositionModalDealer=function(id){$("#allLocations").collapse("show"),$('a[href="#allLocations"]').removeClass("collapsed"),$("#"+id).collapse("show"),setTimeout(function(){$("html,body").animate({scrollTop:document.getElementById(id).offsetTop-30},"slow"),$('a[href="#'+id+'"]').removeClass("collapsed")},500)},CatNS.DealerModal=null,CatNS.DealerModalDetailCollection=Backbone.Collection.extend({fetch:function(dealerId){var dealerIdForEncode=dealerId;dealerIdForEncode=dealerIdForEncode.replace(/\//g,"%");var servicePath=window._cat_effective_url+"/_jcr_content.dealer."+encodeURIComponent(dealerIdForEncode)+".json",collection=this;window.console&&console.log("REDNER",_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:dealerId})),amplify.request.define(CAT_SERVICES_NAME.DEALERS_DETAIL,"ajax",{url:servicePath,dataType:"json",type:"GET"}),amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_DETAIL,success:function(data){var dealerInfo=_.findWhere(amplify.store(CAT_STORE.DEALERS),{encryptedDealerCode:dealerId});dealerInfo.extraData=data,collection.reset(dealerInfo),amplify.publish(CAT_EVENTS.CAT_DEALERS_DETAIL_SUCCESS,collection)},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})}}),CatNS.DealerModalDetail=Backbone.View.extend({template:_.template(CatNS.tpl.get("dealer-modal-detail")),map:"",markers:[],initialize:function(params){var self=this;amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW),amplify.subscribe(CAT_EVENTS.CAT_DEALERS_DETAIL_SUCCESS,self,self.onData),this.collection=new CatNS.DealerModalDetailCollection,this.collection.fetch(params.id)},onData:function(collection){return this.collection=collection.clone(),this.render(),amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE),!1},render:function(){var self=this;$("body").append(this.template({dealer:this.collection.models[0]})),$("#dealer-modal-detail").modal({show:!0,backdrop:!0}),$(".modal-backdrop").on("click",function(){$("#dealer-modal-detail").modal("hide")}),$("#dealer-modal-detail").on("hidden.bs.modal",function(){self.remove(),$("#dealer-modal-detail").remove()}),this.initMap(),$("#dealer-modal-detail").find(".collapse").collapse(),$("html,body").animate({scrollTop:0},"slow")},initMap:function(){var self=this,dealerModel=this.collection.models[0],mapOptions={zoom:7,center:new google.maps.LatLng(dealerModel.get("latitude"),dealerModel.get("longitude")),zoomControl:!0,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};this.map=new google.maps.Map(document.getElementById("dealer_detail_map_canvas"),mapOptions);var location={id:dealerModel.get("intId"),name:dealerModel.get("name"),street:dealerModel.get("street"),postalCode:dealerModel.get("postalCode"),city:dealerModel.get("city"),state:dealerModel.get("state"),country:dealerModel.get("country"),main:!0};new google.maps.LatLng(dealerModel.get("latitude"),dealerModel.get("longitude"));self.clearOverlays(),_.each(dealerModel.get("locations"),function(dealer,index){location={id:dealer.intId,name:dealer.name,street:dealer.street,postalCode:dealer.postalCode,city:dealer.city,state:dealer.state,country:dealer.country,main:0===index};var pos=new google.maps.LatLng(dealer.latitude,dealer.longitude);self.setMarker(pos,location,index)}),self.zoomToFit()},setMarker:function(myLatlng,location,num){var markerIcon,marker,self=this;location.main?(markerIcon=window._cat_imgpath+"/dealerLocator/marker_shadow_dark.png",marker=new MarkerWithLabel({map:self.map,position:myLatlng,visible:!0,icon:markerIcon,labelContent:num+1,title:location.name,labelAnchor:new google.maps.Point(15,27),labelClass:"labels",labelInBackground:!1})):(markerIcon=window._cat_imgpath+"/dealerLocator/marker_shadow_skinny.png",marker=new MarkerWithLabel({map:self.map,position:myLatlng,visible:!0,icon:markerIcon,title:location.name})),self.markers.push(marker);var contentString=($("#result_"+(num+1)).position(),'<div id="infobox" class="map-info-window"><h5 class="map-info-window-heading">'+location.name+"</h5><p>"+location.street+" "+location.postalCode+"<br>"+location.city+" "+location.state+", "+location.country+'</p><a style="cursor:pointer;" onclick="CatNS.moveToPositionModalDealer(\'location'+location.id+'\')">More Info</a><div class="arrow-down"></div></div>'),infobox=new InfoBox({content:contentString,disableAutoPan:!1,maxWidth:250,pixelOffset:new google.maps.Size(-122,-171),zIndex:null,boxStyle:{opacity:1,width:"245px"},closeBoxMargin:"13px 12px 2px 2px; z-index: 9999999;",closeBoxURL:window._cat_imgpath+"/dealerLocator/btn_close.png",infoBoxClearance:new google.maps.Size(1,1)});google.maps.event.addListener(marker,"click",function(){infobox.open(self.map,this)})},zoomToFit:function(){for(var self=this,bounds=new google.maps.LatLngBounds,i=0;i<self.markers.length;i++)bounds.extend(self.markers[i].getPosition());self.map.fitBounds(bounds)},clearOverlays:function(){for(var i=0;i<this.markers.length;i++)this.markers[i].setMap(null);this.markers=[]}}),$("#rental-dealer-facet").length&&CatNS.i18n.loadKeys(function(){new CatNS.DealerFormView;amplify.subscribe(CAT_EVENTS.DEALERS_LIST_SUCCESS,function(collection){new CatNS.DealerListView({model:collection});amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE),CatNS.CATEnhanceModel.onDealersUpdate(collection),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{value:!1})})})})});var CatNS=CatNS||{};head.ready(function(){CatNS.tpl.loadTemplates(["pdp-dealer-pricing","pdp-dealer-detail","dealer-modal","dealer-modal-detail"],function(){CatNS.DealerVerifyCollection=Backbone.Collection.extend({fetch:function(params){console.log("DEALER VERIFY Collection fetch",params);var useOriginalDealerList=!1,pathArray=window.location.href.split("/"),protocol=pathArray[0],host=pathArray[2],url=protocol+"//"+host,product="";params?(useOriginalDealerList=params.useOriginalDealerList,product=params.productPath?params.productPath:window._cat_prodpath):product=window._cat_prodpath;var data='["'+product+'"]',servicePath=url+CAT_SERVICES_URL.DEALERS_BY_PRODUCT+data,collection=this;console.log("calling",servicePath),amplify.request.define(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,"ajax",{url:servicePath,dataType:"json",type:"GET"}),amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,success:function(data){console.log(CAT_SERVICES_NAME.DEALERS_BY_PRODUCT,data);var dealers=amplify.store(CAT_STORE.DEALERS),ids=data.dealers,dealersFiltered=[];_.each(ids,function(id){var dealerFound=_.findWhere(dealers,{encryptedDealerCode:id});dealerFound&&dealersFiltered.push(dealerFound)}),useOriginalDealerList?collection.reset(dealers):collection.reset(dealersFiltered),amplify.publish(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,collection)},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})}}),CatNS.DealerPricingModel=Backbone.Model.extend({defaults:{currency:"USD",dailyRate:"USD00,00.00",weeklyRate:"USD00,00.00",monthlyRate:"USD00,00.00"},initialize:function(){},fetch:function(params){amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);var product=window._cat_prodpath,data='{"product":"'+product+'","dealerCodes":["'+params.code+'"],"currency":"'+params.currency+'"}',model=this,pathArray=window.location.href.split("/"),protocol=pathArray[0],host=pathArray[2],url=protocol+"//"+host,servicePath=url+CAT_SERVICES_URL.DEALERS_RATES+encodeURIComponent(data);amplify.request.define(CAT_SERVICES_NAME.DEALERS_RATES,"ajax",{url:servicePath,dataType:"json",type:"GET"}),amplify.request({resourceId:CAT_SERVICES_NAME.DEALERS_RATES,success:function(data){if(_.values(data).length){if("ok-nodata"===data.status)return amplify.publish(CAT_EVENTS.DEALER_RATES_NO_RATES),void amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE);model.set(_.values(data)[0]),amplify.publish(CAT_EVENTS.DEALER_RATES_SUCCESS,model)}else amplify.publish(CAT_EVENTS.DEALER_RATES_NO_RATES);amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE)},error:function(message,level){amplify.publish(CAT_EVENTS.SERVICE_ERROR,message)}})}}),CatNS.DealerPricingInfoModel=Backbone.Model.extend({defaults:{name:"Dealer Name",locations:[],encryptedDealerCode:"",default:!0},initialize:function(){this.update()},update:function(){var dealersSelected=amplify.store(CAT_STORE.DEALER_SELECTED),currentDealer=amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED),isEmpty=_.isEmpty(amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED));if(console.log("DEALERS DETAL SELECTED MODEL EXIST",currentDealer),isEmpty)if(_.isEmpty(dealersSelected))this.set("default",!0);else{console.log("DEALERS SELECTED MODEL",dealersSelected);var sortByDistance=_.sortBy(dealersSelected,function(dealer){return dealer.distanceInMiles});currentDealer=sortByDistance[0],this.set("default",!1)}else this.set("default",!1);this.get("default")||(this.set("name",currentDealer.name),this.set("locations",currentDealer.locations),this.set("encryptedDealerCode",currentDealer.encryptedDealerCode))}}),CatNS.DealerPricingView=Backbone.View.extend({model:new CatNS.DealerPricingModel,template:_.template(CatNS.tpl.get("pdp-dealer-pricing")),initialize:function(){var self=this;amplify.subscribe(CAT_EVENTS.DEALER_RATES_SUCCESS,self,self.rates),amplify.subscribe(CAT_EVENTS.DEALER_RATES_NO_RATES,self,self.noRates),self.render()},render:function(){this.$el.html(this.template({data:this.model.toJSON()})),this.$el.find("h5").hide(),this.$el.find(".perday").hide(),this.$el.find(".others").hide(),this.$el.find(".additional-notes").hide()},rates:function(){this.render(),"false"===this.model.get("isRates")?this.noRates():(this.$el.removeClass("no-rates"),this.$el.find("h5").show(),this.$el.find(".perday").show(),this.$el.find(".others").show()),this.$el.find(".additional-notes").show()},noRates:function(){this.$el.addClass("no-rates"),this.$el.find("h5").hide(),this.$el.find(".perday").hide(),this.$el.find(".others").hide(),this.$el.find(".additional-notes").hide()}}),CatNS.DealerPricingDropView=Backbone.View.extend({initialize:function(){var self=this;_.isEmpty(amplify.store(CAT_STORE.CURRENCY))?(amplify.store(CAT_STORE.CURRENCY,"USD"),this.$el.find("select").val("USD")):this.$el.find("select").val(amplify.store(CAT_STORE.CURRENCY)),amplify.subscribe(CAT_EVENTS.DEALER_RATES_SUCCESS,self,self.rates),amplify.subscribe(CAT_EVENTS.DEALER_RATES_NO_RATES,self,self.noRates)},events:{"submit #dealer-currency":"onSubmit"},noRates:function(){this.$el.hide()},rates:function(){this.$el.show()},onSubmit:function(e){e.preventDefault(),amplify.publish(CAT_EVENTS.DEALER_CURRENCY_SEARCH,this.$el.find("select").val()),amplify.store(CAT_STORE.CURRENCY,this.$el.find("select").val())},manualSubmit:function(){var self=this;setTimeout(function(){self.$el.find("#dealer-currency").submit()},100)}}),CatNS.DealerPricingInfoView=Backbone.View.extend({showLocations:!0,productPath:"",model:new CatNS.DealerPricingInfoModel,template:_.template(CatNS.tpl.get("pdp-dealer-detail")),initialize:function(params){var self=this;params&&(this.showLocations=!params.showLocations||params.showLocations,this.productPath=!!params.productPath&&params.productPath);var verifyCollection=new CatNS.DealerVerifyCollection;amplify.subscribe(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,function(collection){var validDealersIds=[],storedSelectedDealersIds=[],selected=amplify.store(CAT_STORE.DEALER_SELECTED);collection&&collection.length>0&&collection.each(function(item){validDealersIds.push(item.get("encryptedDealerCode"))}),_.each(selected,function(item){storedSelectedDealersIds.push(item.encryptedDealerCode)}),console.log("valids",validDealersIds),console.log("selecteds",storedSelectedDealersIds),console.log("inter",_.intersection(storedSelectedDealersIds,validDealersIds));var validDealers=_.intersection(storedSelectedDealersIds,validDealersIds);if(validDealers.length){var filteredList=[];_.each(validDealers,function(dealerCode){var item=_.findWhere(selected,{encryptedDealerCode:dealerCode});item&&filteredList.push(item)}),console.log("filtered list",filteredList);var sorted=_.sortBy(filteredList,function(dealer){return dealer?dealer.distanceInMiles:0});sorted[0]?(amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,sorted[0]),self.model.set("name",sorted[0].name),self.model.set("locations",sorted[0].locations),self.model.set("encryptedDealerCode",sorted[0].encryptedDealerCode),console.log("NEW DEALER",sorted[0])):console.log("NO NEW DEALER; undefined")}console.log("Model",self.model),self.render()}),verifyCollection.fetch()},events:{"click a.change-dealer":"clearAction","click .dealer-details":"openModal"},render:function(){this.$el.html(this.template({data:this.model.toJSON(),showLocations:this.showLocations}))},getCode:function(){return this.model.get("encryptedDealerCode")},changeDealer:function(){new CatNS.DealerModalView({productPath:this.productPath})},clearAction:function(e){e&&e.preventDefault(),$(".dealer-pricing-form, .dealer-rental-form").show(),$("input.clearToggle").val(""),$(".dealer-pricing-detail, .dealer-rental-detail").hide(),$(".dealer-pricing-drop").hide(),$(".dealer-pricing-info").hide(),amplify.store(CAT_STORE.DEALERS,null),amplify.store(CAT_STORE.DEALER_SELECTED,null),amplify.store(CAT_STORE.DEALERS_SEARCHED,null),amplify.store(CAT_STORE.DETAIL_DEALER_SELECTED,null),amplify.publish(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET),amplify.publish(CAT_EVENTS.CATALOG_FILTER,{value:!1}),amplify.publish(CAT_EVENTS.DEALERS_AVAILABLE_RENTAL)},update:function(){this.model.update(),this.render()},openModal:function(e){if(e.preventDefault(),$("#request-a-rentalquote-page").length<1){var dealerId=$(e.currentTarget).data("dealer-id");CatNS.DealerModal&&(CatNS.DealerModal=null,delete CatNS.DealerModal),CatNS.DealerModal=new CatNS.DealerModalDetail({id:dealerId})}}}),CatNS.DealerPricingForm=Backbone.View.extend({skip:!1,productPath:"",initialize:function(params){var self=this;this.$el.find(".error-text").hide(),this.skip=params.skipDealerFilter,this.productPath=params.productPath,amplify.subscribe(CAT_EVENTS.DEALERS_LIST_SUCCESS,self,self.onDealersData),amplify.store(CAT_STORE.DEALERS_SEARCHED)&&$("#zip-code").val(amplify.store(CAT_STORE.DEALERS_SEARCHED)),amplify.subscribe(CAT_EVENTS.GOOGLE_GEO_ERROR,function(){$("#zip-code").addClass("error"),self.$el.find(".error-text").show()})},events:{"submit #detail-get-dealer-location":"submitForm"},submitForm:function(event){event.preventDefault(),amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW),$("#zip-code").removeClass("error"),this.$el.find(".error-text").hide();var address=this.$el.find("#zip-code").val();""!==address||void 0!==address?CatNS.CATEnhanceModel.getDealerLocation(address,!0):(console.log("please enter search query"),this.$el.find(".error-text").show())},onDealersData:function(collection){console.log("Dealer Pricing form onDealersData",collection);new CatNS.DealerModalView({useOriginalDealerList:this.skip,productPath:this.productPath})}}),CatNS.DealerPricingControlView=Backbone.View.extend({search:{},rates:{},dropdown:{},dealerInfo:{},initialize:function(){var self=this;amplify.subscribe(CAT_EVENTS.DEALER_CURRENCY_SEARCH,self,self.onCurrencyChange),amplify.subscribe(CAT_EVENTS.DEALER_SELECTED,self,self.onDealerUpdated),this.search=new CatNS.DealerPricingForm({el:$(".dealer-pricing-form")}),this.rates=new CatNS.DealerPricingView({el:$(".dealer-pricing-detail")}),this.dropdown=new CatNS.DealerPricingDropView({el:$(".dealer-pricing-drop")}),this.dealerInfo=new CatNS.DealerPricingInfoView({el:$(".dealer-pricing-info")}),this.checkSteps()},checkSteps:function(){this.dealerInfo.model.get("default")?(this.search.$el.fadeIn(),this.rates.$el.hide(),this.dropdown.$el.hide(),this.dealerInfo.$el.hide()):(this.search.$el.hide(),this.rates.$el.fadeIn(),this.dropdown.$el.fadeIn(),this.dealerInfo.$el.fadeIn(),this.dropdown.manualSubmit())},onCurrencyChange:function(data){var self=this,params={currency:data,code:self.dealerInfo.getCode()};this.rates.model.fetch(params)},onDealerUpdated:function(data){this.dealerInfo.update(),this.dropdown.manualSubmit(),this.checkSteps()}}),CatNS.DealerRentalFormControlView=Backbone.View.extend({search:{},dealerInfo:{},checkCollection:new CatNS.DealerVerifyCollection,initialize:function(){var self=this;amplify.subscribe(CAT_EVENTS.DEALER_SELECTED,self,self.onDealerUpdated),amplify.subscribe(CAT_EVENTS.DEALERS_BY_PRODUCT_SUCCESS,self,self.onVerifyDealer),amplify.subscribe(CAT_EVENTS.CATALOG_FILTER_DEALER_RESET,self,function(){$("#form-dealer-id").val(""),$("#form-dealer-name").val("")}),location.queryString={},$(".lt-ie9").length<1?location.search.substr(1).split("&").forEach(function(pair){if(""!==pair){var parts=pair.split("=");location.queryString[parts[0]]=parts[1]&&decodeURIComponent(parts[1].replace(/\+/g," "))}}):$.each(location.search.substr(1).split("&"),function(idx,pair){if(""!==pair){var parts=pair.split("=");location.queryString[parts[0]]=parts[1]&&decodeURIComponent(parts[1].replace(/\+/g," "))}}),console.log("LOCATION",location.queryString);var productPath=!!location.queryString.productpathNew&&location.queryString.productpathNew,skip=!productPath;this.search=new CatNS.DealerPricingForm({el:$(".dealer-rental-form"),skipDealerFilter:skip,productPath:productPath}),this.dealerInfo=new CatNS.DealerPricingInfoView({el:$(".dealer-rental-detail"),showLocations:!1,productPath:productPath}),this.checkSteps()},checkSteps:function(){this.dealerInfo.model.get("default")?(this.search.$el.fadeIn(),this.dealerInfo.$el.fadeOut()):(location.queryString.productpathNew&&this.checkCollection.fetch({useOriginalDealerList:!1,productPath:location.queryString.productpathNew}),console.log("setting pre dealer id  to",this.dealerInfo.model.get("encryptedDealerCode")),$("#form-dealer-id").val(this.dealerInfo.model.get("encryptedDealerCode")),$("#form-dealer-name").val(this.dealerInfo.model.get("name")),this.search.$el.fadeOut(),this.dealerInfo.$el.fadeIn())},onVerifyDealer:function(collection){},onDealerUpdated:function(data){this.dealerInfo.model.set("name",data.dealer.name),this.dealerInfo.model.set("locations",data.dealer.locations),this.dealerInfo.model.set("encryptedDealerCode",data.dealer.encryptedDealerCode),this.dealerInfo.render(),$("#form-dealer-id").val(data.dealer.encryptedDealerCode),$("#form-dealer-name").val(data.dealer.name),$("#dealer-error").fadeOut(),this.search.$el.fadeOut(),this.dealerInfo.$el.fadeIn()}}),$(".dealer-pricing-container").length&&CatNS.i18n.loadKeys(function(){CatNS.CATEnhanceModel.initialize();new CatNS.DealerPricingControlView({el:$(".dealer-pricing-container")})}),$(".dealer-rental-container").length&&CatNS.i18n.loadKeys(function(){CatNS.CATEnhanceModel.initialize();new CatNS.DealerRentalFormControlView({el:$(".dealer-rental-container")})})})});var CatNS=CatNS||{};head.ready(function(){CatNS.tpl.loadTemplates(["pm-acc-panel-template","pm-row-template"],function(){var __PM_SERVLET=document.URL.replace(".html",".pmsvlet"),CATPMTableDataModel=Backbone.Model.extend({defaults:{operation:"operation name",partNumber:"0",quantity:"0",partName:"part name"}}),CATPMTableDataCollection=Backbone.Collection.extend({url:__PM_SERVLET,model:CATPMTableDataModel,initialize:function(data){this.data=data},parse:function(data){var details=[];return $(data).find("Interval").each(function(index){var job=$(this).find("JobOperation").text();$(this).find("PartInfo").each(function(index){var partNumber=$(this).find("PartNumber").text(),quantity=$(this).find("Quantity").text(),partName=$(this).find("Description").text(),detail=new CATPMTableDataModel({operation:job,partNumber:partNumber,quantity:quantity,partName:partName,code:index});details.push(detail)})}),details},fetch:function(options){return options=options||{},options.dataType="xml",options.type="POST",options.data=this.data,Backbone.Collection.prototype.fetch.call(this,options)}}),CATPMTableView=Backbone.View.extend({model:CATPMTableDataCollection,template:_.template(CatNS.tpl.get("pm-row-template")),initialize:function(params){var self=this;this.model=new CATPMTableDataCollection(params.data),this.model.fetch({success:function(){self.render()},error:function(){$("#pm-serial-number-form").find(".alert-error").parent().removeClass("hidden")}})},render:function(){var html=this.template(this.model);this.$el.html(html);var self=this;setTimeout(function(){var table=self.$el.parent(),selector=$("#"+table.attr("id")+" .flextable-control a");table.flextable({toggleSelector:selector,selectorEnabled:!0}),table.focus(),table.parent().hide().show()},100)}}),CATPMIntervalModel=Backbone.Model.extend({defaults:{id:"0",title:"Interval description",code:"0"}}),CATPMIntervalCollection=Backbone.Collection.extend({url:__PM_SERVLET,model:CATPMIntervalModel,initialize:function(data){this.data=data},parse:function(data){var intervals=[];return $(data).find("pmSegment").each(function(index){var intervalDescription=$(this).find("description").text(),interval=new CATPMIntervalModel({id:index,title:intervalDescription,code:$(this).attr("code")});intervals.push(interval)}),intervals},fetch:function(options){return options=options||{},options.dataType="xml",options.type="POST",options.data=this.data,Backbone.Collection.prototype.fetch.call(this,options)}}),CATPMAccordionView=Backbone.View.extend({el:"#pm-accordion",model:CATPMIntervalCollection,initialize:function(data){var self=this;this.model=new CATPMIntervalCollection(data),this.model.fetch({success:function(){self.render()},error:function(){$("#pm-serial-number-form").find(".alert-error").parent().removeClass("hidden")}})},render:function(){this.$el.empty(),this.model.each(function(interval){var panel=new CATPMPanelView({model:interval.attributes});this.$el.append(panel.el)},this)}}),CATPMPanelView=Backbone.View.extend({model:CATPMIntervalModel,className:"panel panel-default",template:_.template(CatNS.tpl.get("pm-acc-panel-template")),events:{"show.bs.collapse":"onShow","hidden.bs.collapse":"onHide"},initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model))},onShow:function(event){var data={"pm-part-list-code":this.model.code};new CATPMTableView({data:data,el:this.$el.find("tbody")})},onHide:function(event){var table=this.$el.find("table");table.find("tbody").empty(),table.unbind(),table.removeClass("flextable-loaded"),table.data("flextable_info","")}}),CATPMFormView=Backbone.View.extend({el:"#pm-serial-number-form",initialize:function(params){var self=this;this.$el.on("submit",function(evt){self.submit(evt)})},submit:function(event){event.preventDefault(),this.$el.find(".alert-error").parent().addClass("hidden");var field=this.$el.find("#pm-serial-number"),errorField=validateFormField(field),serialNum=this.$el.find("#pm-serial-number").val(),measureVal=this.$el.find("#pm-measure").val(),data={"pm-serial-number":serialNum,"pm-measurement":measureVal};if(errorField){new CATPMAccordionView(data)}}});$(function(){if($("#preventative-maintenance").length){new CATPMFormView}})}),CatNS.tpl.loadTemplates(["tip-row-template"],function(){var __TIP_SERVLET=document.URL.replace(".html",".tipservlet"),CATTIPDataModelType1=Backbone.Model.extend({
defaults:{ekw:"",performanceNumber:"0",voltage:"0",dutyType:"duty type",frequency:"0",rpm:"0",kva:"0",region:"0",emissions:"",bhp:"0",bkw:"0",documents:[]},initialize:function(){var docs=[];_.each(this.get("documents"),function(doc){var doc=new CATTIPDocument(doc);docs.push(doc)}),this.set("documents",docs)},belongsToRegion:function(value){return _.indexOf(this.get("region").split(","),value)>=0}}),CATTIPDocument=Backbone.Model.extend({defaults:{name:"",type:"",size:"",url:""},initialize:function(){this.set("size",(Number(this.get("size"))/1024).toFixed(2))}}),CATTIPCollection=Backbone.Collection.extend({model:CATTIPDataModelType1,fetch:function(params){var servicePath=__TIP_SERVLET,collection=this;amplify.request.define(CAT_SERVICES_NAME.TIP_DATA,"ajax",{url:servicePath,dataType:"json",type:"GET"}),amplify.request({resourceId:CAT_SERVICES_NAME.TIP_DATA,data:params,success:function(data){var conf=data[0];collection.reset(_.rest(data,1)),amplify.publish(CAT_EVENTS.TIP_SUCCESS,conf)},error:function(message,level){console.log("TIP ERROR",message,level),amplify.publish(CAT_EVENTS.SERVICE_ERROR,message),$("#tip-maintenance").find(".alert-error").parent().removeClass("hidden")}})}}),CATTIPTableView=Backbone.View.extend({el:$("#tip-maintenance-table"),model:CATTIPCollection,initialize:function(params){var self=this;amplify.subscribe(CAT_EVENTS.TIP_SUCCESS,function(conf){self.render(conf)}),this.model=new CATTIPCollection,this.model.fetch(params)},render:function(conf){var self=this,tbody=self.$el.find(".tip-data-container"),header=self.$el.find("#tip-header"),topHeader=self.$el.find("#tip-extra-header"),regions=conf.regions,regionsLabels=_.values(regions),regionsKeys=_.keys(regions),headersLabels=_.values(conf.header),extraHeadersLabels=[],headerKeys=_.keys(conf.header),extraHeaders=1===Number(conf.format),regionsColspan=regionsKeys.length+1;_.each(headersLabels,function(value,index){0===index&&header.append('<th data-group="groupHeader" data-ignore="true">'+value+"</th>"),0!==index&&header.append('<th data-group="groupHeader" data-hide="phone-portrait,phone-landscape,tablet-portrait,tablet-landscape">'+value+"</th>")}),extraHeaders&&(extraHeadersLabels=_.values(conf.subheader),_.each(extraHeadersLabels,function(value,index){0===index&&topHeader.append('<th data-group="groupHeader" colspan="'+headerKeys.length+'">'+value+"</th>"),0!==index&&topHeader.append('<th data-group="groupRegion" colspan="'+regionsColspan+'" class="flextable-last-column">'+value+"</th>")}),_.each(regionsLabels,function(region){header.append('<th data-group="groupRegion" data-hide="phone-portrait,phone-landscape,tablet-portrait,tablet-landscape">'+region+"</th>")})),header.append('<th data-group="groupRegion" data-hide="phone-portrait,phone-landscape,tablet-portrait,tablet-landscape">DOCUMENTS</th>'),header.append('<th class="flextable-control">&nbsp;</th>'),_.each(this.model.models,function(row){var crow=new CATTIPRowView({model:row,keys:headerKeys,regions:regionsKeys});tbody.append(crow.$el)}),setTimeout(function(){var table=self.$el,selector=$("#tip-maintenance-table .flextable-control a"),extraHeader=$("#tip-extra-header");1===Number(conf.format)&&extraHeader.removeClass("hidden"),table.flextable({toggleSelector:selector,selectorEnabled:!0}),table.focus(),table.parent().hide().show(),amplify.publish(CAT_EVENTS.CAT_SPINNER_HIDE)},100)}}),CATTIPRowView=Backbone.View.extend({template:_.template(CatNS.tpl.get("tip-row-template")),tagName:"tr",model:CATTIPDataModelType1,keys:[],initialize:function(params){this.keys=params.keys,this.model=params.model,this.regions=params.regions,this.render()},render:function(){var data={model:this.model,keys:this.keys,regions:this.regions};this.$el.html(this.template(data))}});$(function(){if($("#tip-maintenance").length){console.log("START TIP");var params={tipUrl:$("#tipUrl").val(),tipFormat:$("#tipFormat").val()};amplify.publish(CAT_EVENTS.CAT_SPINNER_SHOW);new CATTIPTableView(params)}})})}),$(function(){function updateOrderNowButton(price,currency){if($orderNowBtn=$(".order-now-btn"),void 0!=$orderNowBtn){var hrefValue=$orderNowBtn.attr("href");if(void 0!=hrefValue){var priceMatch=hrefValue.match(/\bprice=(..*)&currency\b/)[1],currencyMatch=hrefValue.match(/\b&currency=(..*)$/)[1];price=price.replace(/[^0-9\.]+/g,""),hrefValue=hrefValue.replace("currency="+currencyMatch,"currency="+currency).replace("price="+priceMatch,"price="+price),$orderNowBtn.attr("href",hrefValue)}}}var storedCurrency=amplify.store("storedCurrency");if($familyCurrencyDropdown=$('.productCards select[name="currency"]'),void 0!=$familyCurrencyDropdown&&(void 0!=storedCurrency&&$familyCurrencyDropdown.find("option").each(function(){$(this).text()===storedCurrency&&$(this).attr("selected",!0)}),$familyCurrencyDropdown.change(function(){var selectValue=$(this).val(),currency=$(this).find('option[value="'+selectValue+'"]').html();$('[class*="product-card-price-"]').hide(),$(".product-card-price-"+currency).show(),amplify.store("storedCurrency",currency)})),$(".pdp-variance-price-section select").change(function(){var price=$(this).val(),currency=$(this).find('option[value="'+price+'"]').html();$(".pdp-variance-price-section .price").html(price),amplify.store("storedCurrency",currency),updateOrderNowButton(price,currency)}),void 0!=storedCurrency&&""!=storedCurrency){var $selectNode=$('.pdp-variance-price-section select[name="currency"]'),$selectedPrice=void 0;$selectNode.find("option").each(function(){$(this).text()===storedCurrency&&($selectedPrice=$(this))}),void 0!=$selectedPrice&&($(".pdp-variance-price-section .price").html($selectedPrice.val()),updateOrderNowButton($selectedPrice.val(),$selectedPrice.text()),$selectedPrice.attr("selected",!0))}}),jQuery(function(){str=window.location.href,str.indexOf("ru_RU")>=0&&jQuery("header nav>ul>li.menu>ul>li.products>div").width("875px")});
